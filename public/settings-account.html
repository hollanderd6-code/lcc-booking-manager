<!DOCTYPE html>

<html data-theme="light" lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport"/>
<title>Boostinghost ‚Äì Param√®tres</title>
<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
<!-- CSS plateforme -->
<link href="/css/style.css" rel="stylesheet"/><link href="/css/bh-shared.css?v=1" rel="stylesheet"/><link href="/css/bottom-bar-enhanced.css" rel="stylesheet"/><link href="/css/menu-plus-fixes.css" rel="stylesheet"/><link href="/css/menu-active-button.css" rel="stylesheet"/>
<link href="/css/messages-badge-fix.css" rel="stylesheet"/>
<link rel="stylesheet" href="/css/messages-badge-red.css">
<link rel="stylesheet" href="/css/messages-badge-desktop.css">    
    <style>
    html, body {
      margin: 0 !important;
      }

    /* (patched) removed inline .main-content padding override for iOS safe-area */

    .page-content {
      margin-top: 0 !important;
      max-width: 960px;
    }

    .page-content section.card {
      margin-bottom: 20px;
    }

    /* ===== Onglets param√®tres ===== */

    .settings-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 16px;
    }

    .settings-tab {
      border: none;
      background: transparent;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background .12s ease, color .12s ease;
    }

    .settings-tab i {
      font-size: 13px;
    }

    .settings-tab.active {
      background: var(--primary-light, rgba(16, 185, 129, 0.08));
      color: var(--primary-color, #059669);
    }

    .settings-tab:hover:not(.active) {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .tab-pane {
      display: none;
      animation: fadeIn .15s ease-out;
    }

    .tab-pane.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(2px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ===== Mise en page interne ===== */

    .form-row-inline {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    @media (max-width: 640px) {
      .form-row-inline {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .settings-hint {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .pill-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
    }

    .stripe-pill-loading {
      background: rgba(148, 163, 184, 0.15);
      color: #475569;
    }

    .stripe-pill-ok {
      background: rgba(34, 197, 94, 0.12);
      color: #166534;
    }

    .stripe-pill-warn {
      background: rgba(249, 115, 22, 0.15);
      color: #9a3412;
    }

    .stripe-pill-error {
      background: rgba(250, 204, 21, 0.18);
      color: #854d0e;
    }

    .save-status-inline {
      margin-top: 8px;
      font-size: 12px;
      color: #059669;
      min-height: 18px;
    }
    /* ===== Onglet Abonnement ===== */
    
    .subscription-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 1px solid var(--border-color);
    }

    .subscription-loading {
      text-align: center;
      padding: 48px 24px;
      color: var(--text-secondary);
    }

    .subscription-loading i {
      font-size: 32px;
      margin-bottom: 16px;
      opacity: 0.3;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    .subscription-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 16px;
    }

    .subscription-info h3 {
      margin: 0 0 8px 0;
      font-size: 20px;
      font-weight: 600;
    }

    .subscription-status {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 500;
    }

    .status-active {
      background: rgba(34, 197, 94, 0.12);
      color: #166534;
    }

    .status-trial {
      background: rgba(59, 130, 246, 0.12);
      color: #1e3a8a;
    }

    .status-expired, .status-canceled {
      background: rgba(239, 68, 68, 0.12);
      color: #7f1d1d;
    }

    .days-remaining {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .subscription-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .subscription-details {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border-color);
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      font-size: 14px;
    }

    .detail-label {
      color: var(--text-secondary);
    }

    .detail-value {
      font-weight: 500;
      color: var(--text-primary);
    }

    .alert-warning {
      margin-top: 16px;
      padding: 16px;
      background: rgba(249, 115, 22, 0.08);
      border: 1px solid rgba(249, 115, 22, 0.2);
      border-radius: var(--radius-md);
      display: flex;
      align-items: flex-start;
      gap: 12px;
      color: #9a3412;
    }

    .alert-warning i {
      font-size: 20px;
      margin-top: 2px;
    }

    .alert-warning strong {
      display: block;
      margin-bottom: 4px;
    }

    /* ===== Facturation Stripe ===== */
    .stripe-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 1px solid var(--border-color);
      margin-top: 16px;
    }

    .stripe-card h3 {
      margin: 0 0 16px 0;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stripe-status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border-color);
    }

    .stripe-status-row:last-child {
      border-bottom: none;
    }

    .stripe-status-label {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .stripe-status-value {
      font-weight: 500;
      color: var(--text-primary);
    }

    /* ===== Onglet √âquipe ===== */
    .team-member-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 20px;
      border: 1px solid var(--border-color);
      margin-bottom: 12px;
      transition: box-shadow 0.2s ease;
    }

    .team-member-card:hover {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .team-member-inactive {
      opacity: 0.6;
      background: var(--bg-tertiary);
    }

    .team-member-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 12px;
    }

    .team-member-info {
      display: flex;
      gap: 16px;
      flex: 1;
    }

    .team-member-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 18px;
      flex-shrink: 0;
    }

    .team-member-details h3 {
      margin: 0 0 4px 0;
      font-size: 16px;
      font-weight: 600;
    }

    .team-member-details p {
      margin: 0 0 6px 0;
      color: var(--text-secondary);
      font-size: 13px;
    }

    .team-member-role {
      display: inline-block;
      padding: 4px 10px;
      background: var(--primary-light);
      color: var(--primary-color);
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
    }

    .team-member-actions {
      display: flex;
      gap: 6px;
    }

    .team-member-permissions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border-color);
    }

    .permission-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(59, 130, 246, 0.08);
      color: #1e40af;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
    }

    .permission-badge i {
      font-size: 11px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: var(--bg-primary);
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-secondary);
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s;
    }

    .modal-close:hover {
      background: var(--bg-secondary);
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    #customPermissions {
      margin-top: 16px;
      padding: 16px;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
    }

    #customPermissions h4 {
      margin: 0 0 12px 0;
      font-size: 14px;
      font-weight: 600;
    }

    .permission-group {
      margin-bottom: 16px;
    }

    .permission-group:last-child {
      margin-bottom: 0;
    }

    .permission-group h5 {
      margin: 0 0 8px 0;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .checkbox-item label {
      font-size: 14px;
      cursor: pointer;
    }

    #roleDescription {
      margin-top: 8px;
      padding: 12px;
      background: rgba(59, 130, 246, 0.08);
      border-left: 3px solid #3b82f6;
      border-radius: 4px;
      font-size: 13px;
      color: var(--text-secondary);
    }

    @media (max-width: 640px) {
      .team-member-header {
        flex-direction: column;
      }

      .team-member-actions {
        width: 100%;
        justify-content: flex-end;
      }

      .modal-content {
        width: 95%;
        max-height: 95vh;
      }
    }
  </style>
</head>
<body>
<!-- Top Bar -->
<div class="bh-topbar">
<div class="bh-logo">
<span class="bh-logo-icon">
<i class="fas fa-rocket"></i>
</span>
<span class="bh-logo-text">boostinghost</span>
</div>
<div class="bh-user">
<div class="bh-user-info">
<span class="bh-user-name" id="userName">Chargement...</span>
<span class="bh-user-email" id="userEmail">...</span>
</div>
<div class="bh-user-avatar" id="userAvatar">...</div>
</div>
</div>
<!-- Sidebar -->
<aside class="bh-sidebar">
<nav class="bh-menu">
<a class="bh-menu-item" href="/index.html">
<i class="fas fa-chart-line"></i>
<span>Tableau de bord</span>
</a>
<a class="bh-menu-item" href="/calendar.html">
<i class="fas fa-calendar-alt"></i>
<span>Calendrier</span>
</a>
<a class="bh-menu-item" href="/messages.html">
<i class="fas fa-comment-dots"></i>
<span>Messages</span>
<span class="messages-badge" id="msgBadge" style="display:none;">0</span>
</a>
<a class="bh-menu-item" href="/logements.html">
<i class="fas fa-home"></i>
<span>Logements</span>
</a>
<a class="bh-menu-item" href="/menage.html">
<i class="fas fa-broom"></i>
<span>M√©nages</span>
</a>
<a class="bh-menu-item" href="/finances.html">
<i class="fas fa-wallet"></i>
<span>Finances</span>
</a>
<a class="bh-menu-item active" href="/settings-account.html">
<i class="fas fa-cog"></i>
<span>Param√®tres</span>
</a>
<a class="bh-menu-item" href="#" onclick="logout()">
<i class="fas fa-sign-out-alt"></i>
<span>D√©connexion</span>
</a>
</nav>
</aside>
<!-- Main Content -->
<main class="main-content">
<div class="page-content">
<h1 style="margin-bottom: 24px;">‚öôÔ∏è Param√®tres</h1>
<!-- Onglets -->
<div class="settings-tabs">
<button class="settings-tab active" data-tab="account">
<i class="fas fa-user-circle"></i>
Mon compte
</button>
<button class="settings-tab" data-tab="security">
<i class="fas fa-shield-alt"></i>
S√©curit√©
</button>
<button class="settings-tab" data-tab="notifications">
<i class="fas fa-bell"></i>
Notifications
</button>
<button class="settings-tab" data-tab="subscription">
<i class="fas fa-credit-card"></i>
Abonnement
</button>
<button class="settings-tab" data-tab="team">
<i class="fas fa-users"></i>
√âquipe
</button>
</div>
<!-- Panes -->
<!-- Mon compte -->
<div class="tab-pane active" id="accountPane">
<section class="card">
<div class="card-header">
<h2>Informations personnelles</h2>
</div>
<div class="card-body">
<form id="accountForm">
<div class="form-row-inline">
<div class="form-group">
<label>Pr√©nom</label>
<input class="form-control" id="firstName" placeholder="Jean" required="" type="text"/>
</div>
<div class="form-group">
<label>Nom</label>
<input class="form-control" id="lastName" placeholder="Dupont" required="" type="text"/>
</div>
</div>
<div class="form-group">
<label>Email</label>
<input class="form-control" id="email" placeholder="jean.dupont@exemple.fr" required="" type="email"/>
</div>
<div class="form-group">
<label>T√©l√©phone</label>
<input class="form-control" id="phone" placeholder="+33 6 12 34 56 78" type="tel"/>
</div>
<div class="save-status-inline" id="accountSaveStatus"></div>
<button class="btn btn-primary" type="submit">
<i class="fas fa-save"></i>
Enregistrer
</button>
</form>
</div>
</section>
</div>
<!-- S√©curit√© -->
<div class="tab-pane" id="securityPane">
<section class="card">
<div class="card-header">
<h2>Modifier le mot de passe</h2>
</div>
<div class="card-body">
<form id="passwordForm">
<div class="form-group">
<label>Mot de passe actuel</label>
<input class="form-control" id="currentPassword" required="" type="password"/>
</div>
<div class="form-group">
<label>Nouveau mot de passe</label>
<input class="form-control" id="newPassword" minlength="8" required="" type="password"/>
<p class="settings-hint">8 caract√®res minimum</p>
</div>
<div class="form-group">
<label>Confirmer le nouveau mot de passe</label>
<input class="form-control" id="confirmPassword" minlength="8" required="" type="password"/>
</div>
<div class="save-status-inline" id="passwordSaveStatus"></div>
<button class="btn btn-primary" type="submit">
<i class="fas fa-key"></i>
Changer le mot de passe
</button>
</form>
</div>
</section>
</div>
<!-- Notifications -->
<div class="tab-pane" id="notificationsPane">
<section class="card">
<div class="card-header">
<h2>Pr√©f√©rences de notifications</h2>
</div>
<div class="card-body">
<form id="notificationsForm">
<div class="form-group">
<label class="checkbox-container">
<input id="emailNotifications" type="checkbox"/>
<span class="checkmark"></span>
<span class="checkbox-label">Recevoir les notifications par email</span>
</label>
<p class="settings-hint">Nouvelles r√©servations, messages, etc.</p>
</div>
<div class="form-group">
<label class="checkbox-container">
<input id="smsNotifications" type="checkbox"/>
<span class="checkmark"></span>
<span class="checkbox-label">Recevoir les notifications par SMS</span>
</label>
<p class="settings-hint">Alertes urgentes uniquement</p>
</div>
<div class="save-status-inline" id="notificationsSaveStatus"></div>
<button class="btn btn-primary" type="submit">
<i class="fas fa-save"></i>
Enregistrer
</button>
</form>
</div>
</section>
</div>
<!-- Abonnement -->
<div class="tab-pane" id="subscriptionPane">
<section class="card">
<div class="subscription-card" id="subscriptionCard">
<div class="subscription-loading">
<i class="fas fa-circle-notch"></i>
<p>Chargement...</p>
</div>
</div>
<!-- Stripe info -->
<div class="stripe-card">
<h3>
<i class="fab fa-stripe"></i>
Facturation Stripe
</h3>
<div class="stripe-status-row">
<span class="stripe-status-label">Statut de connexion</span>
<span class="pill-status stripe-pill-loading" id="stripeStatusPill">
<i class="fas fa-circle-notch fa-spin"></i>
V√©rification...
</span>
</div>
<div class="stripe-status-row">
<span class="stripe-status-label">ID Stripe</span>
<span class="stripe-status-value" id="stripeCustomerId">‚Äî</span>
</div>
<div class="stripe-status-row">
<span class="stripe-status-label">Dernier paiement</span>
<span class="stripe-status-value" id="stripeLastPayment">‚Äî</span>
</div>
</div>
</section>
</div>
<!-- √âquipe -->
<div class="tab-pane" id="teamPane">
<section class="card">
<div class="flex items-center justify-between mb-4">
<h2>üë• Gestion d'√©quipe</h2>
<button class="btn btn-primary btn-sm" id="btnAddTeamMember">
<i class="fas fa-plus"></i>
Ajouter un membre
</button>
</div>
<div id="teamMembersList">
<div style="text-align:center;padding:48px 24px;color:#9ca3af;">
<i class="fas fa-circle-notch fa-spin" style="font-size:32px;margin-bottom:16px;"></i>
<p>Chargement...</p>
</div>
</div>
</section>
</div>
</div>
</main>
<!-- Modal Ajouter membre -->
<div class="modal" id="addTeamMemberModal">
<div class="modal-content">
<div class="modal-header">
<h2>‚ûï Ajouter un membre d'√©quipe</h2>
<button class="modal-close" id="closeAddMemberModal">√ó</button>
</div>
<div class="modal-body">
<form id="addTeamMemberForm">
<div class="form-row-inline">
<div class="form-group">
<label>Pr√©nom</label>
<input class="form-control" id="memberFirstName" placeholder="Marie" required="" type="text"/>
</div>
<div class="form-group">
<label>Nom</label>
<input class="form-control" id="memberLastName" placeholder="Martin" required="" type="text"/>
</div>
</div>
<div class="form-group">
<label>Email</label>
<input class="form-control" id="memberEmail" placeholder="marie.martin@exemple.fr" required="" type="email"/>
</div>
<div class="form-group">
<label>Mot de passe initial</label>
<input class="form-control" id="memberPassword" minlength="8" placeholder="8 caract√®res minimum" required="" type="password"/>
</div>
<div class="form-group">
<label>R√¥le</label>
<select class="form-control" id="memberRole" required="">
<option value="manager">üëî Manager</option>
<option value="cleaner">üßπ Femme de m√©nage</option>
<option value="accountant">üìä Comptable</option>
<option value="custom">üé® Personnalis√©</option>
</select>
<p class="settings-hint" id="roleDescription">Acc√®s complet au calendrier, messages et m√©nages. Id√©al pour un assistant ou coll√®gue.</p>
</div>
<div class="form-group">
<label>Logements accessibles</label>
<select class="form-control" id="memberProperties" multiple="" required="" style="min-height:100px;">
<!-- Rempli dynamiquement -->
</select>
<p class="settings-hint">Maintenez Ctrl/Cmd pour s√©lectionner plusieurs logements</p>
</div>
<!-- Permissions personnalis√©es -->
<div id="customPermissions" style="display:none;">
<h4>Permissions personnalis√©es</h4>
<div class="permission-group">
<h5>üìÖ Calendrier</h5>
<div class="checkbox-group">
<div class="checkbox-item">
<input id="perm_canViewCalendar" type="checkbox"/>
<label for="perm_canViewCalendar">Voir le calendrier</label>
</div>
<div class="checkbox-item">
<input id="perm_canEditReservations" type="checkbox"/>
<label for="perm_canEditReservations">Modifier les r√©servations</label>
</div>
<div class="checkbox-item">
<input id="perm_canCreateReservations" type="checkbox"/>
<label for="perm_canCreateReservations">Cr√©er des r√©servations</label>
</div>
</div>
</div>
<div class="permission-group">
<h5>üí¨ Messages</h5>
<div class="checkbox-group">
<div class="checkbox-item">
<input id="perm_canViewMessages" type="checkbox"/>
<label for="perm_canViewMessages">Voir les messages</label>
</div>
<div class="checkbox-item">
<input id="perm_canSendMessages" type="checkbox"/>
<label for="perm_canSendMessages">Envoyer des messages</label>
</div>
</div>
</div>
<div class="permission-group">
<h5>üßπ M√©nages</h5>
<div class="checkbox-group">
<div class="checkbox-item">
<input id="perm_canViewCleaning" type="checkbox"/>
<label for="perm_canViewCleaning">Voir les m√©nages</label>
</div>
<div class="checkbox-item">
<input id="perm_canAssignCleaning" type="checkbox"/>
<label for="perm_canAssignCleaning">Assigner des m√©nages</label>
</div>
</div>
</div>
<div class="permission-group">
<h5>üí∞ Finances</h5>
<div class="checkbox-group">
<div class="checkbox-item">
<input id="perm_canViewFinances" type="checkbox"/>
<label for="perm_canViewFinances">Voir les finances</label>
</div>
</div>
</div>
<div class="permission-group">
<h5>üè† Logements</h5>
<div class="checkbox-group">
<div class="checkbox-item">
<input id="perm_canViewProperties" type="checkbox"/>
<label for="perm_canViewProperties">Voir les logements</label>
</div>
</div>
</div>
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-ghost" id="cancelAddMember">Annuler</button>
<button class="btn btn-primary" form="addTeamMemberForm" type="submit">
<i class="fas fa-plus"></i>
Ajouter
</button>
</div>
</div>
</div>
<!-- Bottom Bar (mobile) -->
<div class="bh-bottom-bar">
<a class="bh-bottom-item" href="/index.html">
<i class="fas fa-chart-line"></i>
<span>Accueil</span>
</a>
<a class="bh-bottom-item" href="/calendar.html">
<i class="fas fa-calendar-alt"></i>
<span>Calendrier</span>
</a>
<a class="bh-bottom-item" href="/messages.html">
<i class="fas fa-comment-dots"></i>
<span>Messages</span>
<span class="messages-badge" id="msgBadgeMobile" style="display:none;">0</span>
</a>
<a class="bh-bottom-item" href="/logements.html">
<i class="fas fa-home"></i>
<span>Logements</span>
</a>
<a class="bh-bottom-item active" href="/settings-account.html">
<i class="fas fa-cog"></i>
<span>Param√®tres</span>
</a>
</div>
<!-- Scripts -->
<script>
    // ===== Global =====
    function logout() {
      localStorage.removeItem('lcc_token');
      window.location.href = '/login.html';
    }

    // ===== Onglets =====
    document.addEventListener('DOMContentLoaded', function() {
      const tabs = document.querySelectorAll('.settings-tab');
      const panes = document.querySelectorAll('.tab-pane');

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.forEach(t => t.classList.remove('active'));
          panes.forEach(p => p.classList.remove('active'));

          tab.classList.add('active');
          const targetId = tab.dataset.tab + 'Pane';
          document.getElementById(targetId).classList.add('active');
        });
      });
    });

    // ===== Chargement des donn√©es utilisateur =====
    async function loadUserData() {
      const token = localStorage.getItem('lcc_token');
      if (!token) {
        window.location.href = '/login.html';
        return;
      }

      try {
        const res = await fetch('/api/auth/user', {
          headers: { 'Authorization': 'Bearer ' + token }
        });

        if (!res.ok) throw new Error('Erreur');

        const data = await res.json();

        document.getElementById('userName').textContent = data.user.first_name + ' ' + data.user.last_name;
        document.getElementById('userEmail').textContent = data.user.email;
        const initials = `${data.user.first_name?.charAt(0) || ''}${data.user.last_name?.charAt(0) || ''}`;
        document.getElementById('userAvatar').textContent = initials;

        // Remplir les formulaires
        document.getElementById('firstName').value = data.user.first_name || '';
        document.getElementById('lastName').value = data.user.last_name || '';
        document.getElementById('email').value = data.user.email || '';
        document.getElementById('phone').value = data.user.phone || '';

        document.getElementById('emailNotifications').checked = data.user.email_notifications ?? true;
        document.getElementById('smsNotifications').checked = data.user.sms_notifications ?? false;

      } catch (error) {
        console.error('Erreur:', error);
        logout();
      }
    }

    // ===== Formulaire compte =====
    document.getElementById('accountForm')?.addEventListener('submit', async function(e) {
      e.preventDefault();
      const token = localStorage.getItem('lcc_token');

      const data = {
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value
      };

      try {
        const res = await fetch('/api/auth/update-profile', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify(data)
        });

        if (!res.ok) throw new Error('Erreur');

        document.getElementById('accountSaveStatus').textContent = '‚úÖ Enregistr√© !';
        setTimeout(() => {
          document.getElementById('accountSaveStatus').textContent = '';
        }, 3000);

      } catch (error) {
        document.getElementById('accountSaveStatus').textContent = '‚ùå Erreur';
        document.getElementById('accountSaveStatus').style.color = '#dc2626';
      }
    });

    // ===== Formulaire mot de passe =====
    document.getElementById('passwordForm')?.addEventListener('submit', async function(e) {
      e.preventDefault();
      const token = localStorage.getItem('lcc_token');

      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      if (newPassword !== confirmPassword) {
        document.getElementById('passwordSaveStatus').textContent = '‚ùå Les mots de passe ne correspondent pas';
        document.getElementById('passwordSaveStatus').style.color = '#dc2626';
        return;
      }

      try {
        const res = await fetch('/api/auth/change-password', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({ currentPassword, newPassword })
        });

        if (!res.ok) {
          const err = await res.json();
          throw new Error(err.error || 'Erreur');
        }

        document.getElementById('passwordSaveStatus').textContent = '‚úÖ Mot de passe chang√© !';
        document.getElementById('passwordSaveStatus').style.color = '#059669';
        this.reset();

        setTimeout(() => {
          document.getElementById('passwordSaveStatus').textContent = '';
        }, 3000);

      } catch (error) {
        document.getElementById('passwordSaveStatus').textContent = '‚ùå ' + error.message;
        document.getElementById('passwordSaveStatus').style.color = '#dc2626';
      }
    });

    // ===== Formulaire notifications =====
    document.getElementById('notificationsForm')?.addEventListener('submit', async function(e) {
      e.preventDefault();
      const token = localStorage.getItem('lcc_token');

      const data = {
        emailNotifications: document.getElementById('emailNotifications').checked,
        smsNotifications: document.getElementById('smsNotifications').checked
      };

      try {
        const res = await fetch('/api/auth/update-notifications', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify(data)
        });

        if (!res.ok) throw new Error('Erreur');

        document.getElementById('notificationsSaveStatus').textContent = '‚úÖ Enregistr√© !';
        setTimeout(() => {
          document.getElementById('notificationsSaveStatus').textContent = '';
        }, 3000);

      } catch (error) {
        document.getElementById('notificationsSaveStatus').textContent = '‚ùå Erreur';
        document.getElementById('notificationsSaveStatus').style.color = '#dc2626';
      }
    });

    // Charger les donn√©es au chargement
    document.addEventListener('DOMContentLoaded', loadUserData);

    // ===== Onglet Abonnement =====

    function formatEUR(amount) {
      return new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(amount);
    }

    function planDisplayName(planType) {
      const plans = {
        solo: 'Solo',
        basic: 'Basic',
        pro: 'Pro'
      };
      return plans[planType] || planType;
    }

    function priceForPlan(planType) {
      const prices = {
        solo: 29,
        basic: 49,
        pro: 99
      };
      return prices[planType] || 0;
    }

    async function loadSubscriptionStatus() {
      const token = localStorage.getItem('lcc_token');
      const subscriptionCard = document.getElementById('subscriptionCard');

      subscriptionCard.innerHTML = `
        <div class="subscription-loading">
          <i class="fas fa-circle-notch"></i>
          <p>Chargement...</p>
        </div>
      `;

      try {
        const res = await fetch('/api/billing/subscription-status', {
          headers: { 'Authorization': 'Bearer ' + token }
        });

        if (!res.ok) throw new Error('Erreur r√©seau');

        const data = await res.json();

        let statusBadgeClass = '';
        let statusBadgeText = '';
        let statusIcon = '';
        let daysRemainingHTML = '';
        let warningHTML = '';

        if (data.status === 'trial') {
          statusBadgeClass = 'status-trial';
          statusBadgeText = 'Essai gratuit';
          statusIcon = 'fa-flask';
          if (data.daysRemaining !== undefined) {
            daysRemainingHTML = `<span class="days-remaining">${data.daysRemaining} jour${data.daysRemaining > 1 ? 's' : ''} restant${data.daysRemaining > 1 ? 's' : ''}</span>`;
          }
          if (data.daysRemaining <= 3) {
            warningHTML = `
              <div class="alert-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                  <strong>Votre essai expire bient√¥t !</strong><br>
                  Choisissez un plan pour continuer sans interruption.
                </div>
              </div>
            `;
          }
        } else if (data.status === 'active') {
          statusBadgeClass = 'status-active';
          statusBadgeText = 'Actif';
          statusIcon = 'fa-check-circle';
        } else if (data.status === 'expired') {
          statusBadgeClass = 'status-expired';
          statusBadgeText = 'Expir√©';
          statusIcon = 'fa-exclamation-circle';
          warningHTML = `
            <div class="alert-warning">
              <i class="fas fa-exclamation-triangle"></i>
              <div>
                <strong>Votre essai a expir√© !</strong><br>
                Choisissez un plan pour continuer √† utiliser Boostinghost.
              </div>
            </div>
          `;
        } else if (data.status === 'canceled') {
          statusBadgeClass = 'status-canceled';
          statusBadgeText = 'Annul√©';
          statusIcon = 'fa-times-circle';
          warningHTML = `
            <div class="alert-warning">
              <i class="fas fa-exclamation-triangle"></i>
              <div>
                <strong>Votre essai expire bient√¥t !</strong><br>
                Choisissez un plan pour continuer sans interruption.
              </div>
            </div>
          `;
        }

        let actionsHTML = '';
        if (data.status === 'trial') {
          actionsHTML = `
            <a href="/pricing.html" class="btn btn-primary">
              <i class="fas fa-arrow-right"></i>
              Choisir un plan
            </a>
          `;
        } else if (data.status === 'active') {
          actionsHTML = `
            <button class="btn btn-ghost" onclick="openStripePortal()">
              <i class="fas fa-cog"></i>
              G√©rer mon abonnement
            </button>
            ${data.planType === 'solo' || data.planType === 'basic' ? `
              <a href="/pricing.html" class="btn btn-primary">
                <i class="fas fa-arrow-up"></i>
                Passer √† Pro
              </a>
            ` : ''}
          `;
        } else if (data.status === 'expired' || data.status === 'canceled') {
          actionsHTML = `
            <a href="/pricing.html" class="btn btn-primary">
              <i class="fas fa-redo"></i>
              R√©activer mon abonnement
            </a>
          `;
        }

        let detailsHTML = '';
        if (data.status === 'active') {
          const renewalDate = data.currentPeriodEnd 
            ? new Date(data.currentPeriodEnd).toLocaleDateString('fr-FR', { day: '2-digit', month: 'long', year: 'numeric' })
            : 'N/A';
          
          detailsHTML = `
            <div class="subscription-details">
              <div class="detail-row">
                <span class="detail-label">Plan</span>
                <span class="detail-value">${planDisplayName(data.planType)}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Prix</span>
                <span class="detail-value">${formatEUR(priceForPlan(data.planType))} / mois</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Prochain renouvellement</span>
                <span class="detail-value">${renewalDate}</span>
              </div>
            </div>
          `;
        }

        subscriptionCard.innerHTML = `
          <div class="subscription-header">
            <div class="subscription-info">
              <h3>${data.displayMessage || 'Mon abonnement'}</h3>
              <div class="subscription-status">
                <div class="status-badge ${statusBadgeClass}">
                  <i class="fas ${statusIcon}"></i>
                  ${statusBadgeText}
                </div>
                ${daysRemainingHTML}
              </div>
            </div>
            <div class="subscription-actions">
              ${actionsHTML}
            </div>
          </div>
          ${detailsHTML}
          ${warningHTML}
        `;

      } catch (err) {
        console.error('Erreur:', err);
        subscriptionCard.innerHTML = `
          <div class="alert-warning">
            <i class="fas fa-exclamation-triangle"></i>
            <div>
              <strong>Erreur de chargement</strong><br>
              Impossible de r√©cup√©rer les informations.
            </div>
          </div>
        `;
      }
    }

    async function openStripePortal() {
      const token = localStorage.getItem('lcc_token');
      if (!token) {
        alert("Session expir√©e, reconnecte-toi.");
        window.location.href = '/login.html';
        return;
      }

      try {
        const res = await fetch('/api/billing/create-portal-session', {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + token }
        });

        if (res.status === 404) {
          alert("Le portail de facturation est disponible apr√®s souscription (hors essai).");
          window.location.href = '/pricing.html';
          return;
        }

        if (!res.ok) throw new Error('Erreur');

        const data = await res.json();
        if (data.url) {
          window.location.href = data.url;
        } else {
          alert("Impossible d'ouvrir le portail.");
        }
      } catch (err) {
        console.error('Erreur:', err);
        alert("Impossible d'ouvrir le portail.");
      }
    }

    // Charger au clic sur l'onglet
    document.addEventListener('DOMContentLoaded', function() {
      const tabButtons = document.querySelectorAll('.settings-tab');
      tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          if (btn.dataset.tab === 'subscription') {
            setTimeout(() => loadSubscriptionStatus(), 100);
          }
        });
      });
    });
</script>
<script src="/js/bh-layout.js"></script>
<script src="/js/mobile-native-experience.js"></script>
<script src="/js/mobile-tabs-handler.js"></script>
<script src="/js/messages-badge-desktop-mobile.js"></script>
<script src="/js/messages-badge-dynamic.js"></script>

<!-- ===== SCRIPT √âQUIPE - VERSION CORRIG√âE ===== -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('üü¢ Script √©quipe charg√© - DOM ready');
  
  const ROLE_DESCRIPTIONS = {
    manager: 'Acc√®s complet au calendrier, messages et m√©nages. Id√©al pour un assistant ou coll√®gue.',
    cleaner: 'Acc√®s au calendrier (lecture) et gestion des m√©nages uniquement.',
    accountant: 'Acc√®s aux finances et au calendrier (lecture).',
    custom: 'Choisissez manuellement chaque permission.'
  };

  // ===== Fonction de chargement des membres =====
  async function loadTeamMembers() {
    try {
      const token = localStorage.getItem('lcc_token');
      const res = await fetch('/api/sub-accounts/list', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await res.json();
      
      if (!data.success) throw new Error(data.error);
      
      displayTeamMembers(data.subAccounts);
    } catch (error) {
      console.error('Erreur:', error);
      alert('Erreur lors du chargement de l\'√©quipe');
    }
  }

  // ===== Affichage des membres =====
  function displayTeamMembers(members) {
    const container = document.getElementById('teamMembersList');
    
    if (members.length === 0) {
      container.innerHTML = `
        <div style="text-align:center;padding:48px 24px;color:#9ca3af;">
          <i class="fas fa-users" style="font-size:48px;margin-bottom:16px;opacity:0.3;"></i>
          <p>Aucun membre d'√©quipe</p>
        </div>
      `;
      return;
    }

    container.innerHTML = members.map(member => {
      const initials = `${member.first_name?.charAt(0) || ''}${member.last_name?.charAt(0) || ''}`;
      const isActive = member.is_active;
      
      const permissions = [];
      if (member.can_view_calendar) permissions.push({ icon: 'calendar', label: 'Calendrier' });
      if (member.can_view_messages) permissions.push({ icon: 'comment-dots', label: 'Messages' });
      if (member.can_view_cleaning) permissions.push({ icon: 'broom', label: 'M√©nages' });
      if (member.can_view_finances) permissions.push({ icon: 'dollar-sign', label: 'Finances' });
      if (member.can_view_properties) permissions.push({ icon: 'home', label: 'Logements' });

      const roleLabels = {
        manager: 'üëî Manager',
        cleaner: 'üßπ Femme de m√©nage',
        accountant: 'üìä Comptable',
        custom: 'üé® Personnalis√©'
      };

      return `
        <div class="team-member-card ${!isActive ? 'team-member-inactive' : ''}">
          <div class="team-member-header">
            <div class="team-member-info">
              <div class="team-member-avatar">${initials}</div>
              <div class="team-member-details">
                <h3>${member.first_name} ${member.last_name}</h3>
                <p>${member.email}</p>
                <span class="team-member-role">${roleLabels[member.role] || member.role}</span>
                ${!isActive ? '<span style="color:#ef4444;font-size:12px;margin-left:8px;">‚óè D√©sactiv√©</span>' : ''}
              </div>
            </div>
            <div class="team-member-actions">
              <button class="btn btn-ghost btn-sm" onclick="editTeamMember(${member.id})">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-ghost btn-sm" onclick="toggleTeamMember(${member.id})">
                <i class="fas fa-${isActive ? 'pause' : 'play'}-circle"></i>
              </button>
              <button class="btn btn-ghost btn-sm" onclick="deleteTeamMember(${member.id}, '${member.email}')">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
          ${permissions.length > 0 ? `
            <div class="team-member-permissions">
              ${permissions.map(p => `
                <span class="permission-badge">
                  <i class="fas fa-${p.icon}"></i> ${p.label}
                </span>
              `).join('')}
            </div>
          ` : ''}
        </div>
      `;
    }).join('');
  }

  // ===== CORRECTION : Initialisation du bouton avec d√©lai =====
  function initAddMemberButton() {
    const btnAdd = document.getElementById('btnAddTeamMember');
    
    if (!btnAdd) {
      console.warn('‚ö†Ô∏è Bouton btnAddTeamMember non trouv√©, nouvelle tentative dans 100ms');
      setTimeout(initAddMemberButton, 100);
      return;
    }
    
    console.log('‚úÖ Bouton btnAddTeamMember trouv√©, ajout du listener');
    
    btnAdd.addEventListener('click', async function(e) {
      e.preventDefault();
      console.log('üîµ Bouton cliqu√©');
      
      const modal = document.getElementById('addTeamMemberModal');
      if (modal) {
        modal.style.display = 'flex';
        await loadPropertiesForSelect();
      } else {
        console.error('‚ùå Modal non trouv√©');
      }
    });
  }

  // ===== Fermeture modal =====
  const closeBtn = document.getElementById('closeAddMemberModal');
  if (closeBtn) {
    closeBtn.addEventListener('click', () => {
      document.getElementById('addTeamMemberModal').style.display = 'none';
    });
  }

  const cancelBtn = document.getElementById('cancelAddMember');
  if (cancelBtn) {
    cancelBtn.addEventListener('click', () => {
      document.getElementById('addTeamMemberModal').style.display = 'none';
    });
  }

  // ===== Changement de r√¥le =====
  const roleSelect = document.getElementById('memberRole');
  if (roleSelect) {
    roleSelect.addEventListener('change', function() {
      const desc = document.getElementById('roleDescription');
      const customPerms = document.getElementById('customPermissions');
      
      desc.textContent = ROLE_DESCRIPTIONS[this.value] || '';
      customPerms.style.display = this.value === 'custom' ? 'block' : 'none';
    });
  }

  // ===== Charger les logements =====
  async function loadPropertiesForSelect() {
    try {
      const token = localStorage.getItem('lcc_token');
      const res = await fetch('/api/properties', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await res.json();
      
      const select = document.getElementById('memberProperties');
      select.innerHTML = data.properties.map(p => 
        `<option value="${p.id}">${p.name}</option>`
      ).join('');
    } catch (error) {
      console.error('Erreur:', error);
    }
  }

  // ===== Formulaire d'ajout =====
  const addForm = document.getElementById('addTeamMemberForm');
  if (addForm) {
    addForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const role = document.getElementById('memberRole').value;
      const data = {
        email: document.getElementById('memberEmail').value,
        password: document.getElementById('memberPassword').value,
        firstName: document.getElementById('memberFirstName').value,
        lastName: document.getElementById('memberLastName').value,
        role: role,
        propertyIds: Array.from(document.getElementById('memberProperties').selectedOptions).map(o => o.value)
      };

      if (role === 'custom') {
        data.permissions = {
          canViewCalendar: document.getElementById('perm_canViewCalendar')?.checked || false,
          canEditReservations: document.getElementById('perm_canEditReservations')?.checked || false,
          canCreateReservations: document.getElementById('perm_canCreateReservations')?.checked || false,
          canViewMessages: document.getElementById('perm_canViewMessages')?.checked || false,
          canSendMessages: document.getElementById('perm_canSendMessages')?.checked || false,
          canViewCleaning: document.getElementById('perm_canViewCleaning')?.checked || false,
          canAssignCleaning: document.getElementById('perm_canAssignCleaning')?.checked || false,
          canViewFinances: document.getElementById('perm_canViewFinances')?.checked || false,
          canViewProperties: document.getElementById('perm_canViewProperties')?.checked || false
        };
      }

      try {
        const token = localStorage.getItem('lcc_token');
        const res = await fetch('/api/sub-accounts/create', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(data)
        });

        const result = await res.json();
        if (!result.success) throw new Error(result.error);

        alert('‚úÖ Membre ajout√©');
        document.getElementById('addTeamMemberModal').style.display = 'none';
        this.reset();
        loadTeamMembers();
      } catch (error) {
        alert('‚ùå ' + error.message);
      }
    });
  }

  // ===== Fonctions globales =====
  window.deleteTeamMember = async function(id, email) {
    if (!confirm(`Supprimer ${email} ?`)) return;
    
    try {
      const token = localStorage.getItem('lcc_token');
      const res = await fetch(`/api/sub-accounts/${id}`, {
        method: 'DELETE',
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await res.json();
      
      if (!data.success) throw new Error(data.error);
      
      alert('‚úÖ Supprim√©');
      loadTeamMembers();
    } catch (error) {
      alert('‚ùå ' + error.message);
    }
  };

  window.toggleTeamMember = async function(id) {
    try {
      const token = localStorage.getItem('lcc_token');
      const res = await fetch(`/api/sub-accounts/${id}/toggle`, {
        method: 'PUT',
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await res.json();
      
      if (!data.success) throw new Error(data.error);
      
      loadTeamMembers();
    } catch (error) {
      alert('‚ùå ' + error.message);
    }
  };

  window.editTeamMember = function(id) {
    alert('En d√©veloppement');
  };

  // ===== Charger les membres quand on clique sur l'onglet √âquipe =====
  const teamTab = document.querySelector('[data-tab="team"]');
  if (teamTab) {
    teamTab.addEventListener('click', () => {
      setTimeout(() => {
        loadTeamMembers();
        // CORRECTION : R√©initialiser le bouton apr√®s chargement de l'onglet
        initAddMemberButton();
      }, 100);
    });
  }

  // ===== Initialisation au chargement =====
  initAddMemberButton();
});
</script>
</body>
</html>
