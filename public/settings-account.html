<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bookingmanage – Paramètres</title>
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <!-- CSS plateforme -->
  <link rel="stylesheet" href="/css/style.css">

  <style>
    html, body {
      margin: 0 !important;
      padding: 0 !important;
    }

    .main-content {
      padding-top: 24px !important;
    }

    .page-content {
      margin-top: 0 !important;
      max-width: 960px;
    }

    .page-content section.card {
      margin-bottom: 20px;
    }

    /* ===== Onglets paramètres ===== */

    .settings-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 16px;
    }

    .settings-tab {
      border: none;
      background: transparent;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background .12s ease, color .12s ease;
    }

    .settings-tab i {
      font-size: 13px;
    }

    .settings-tab.active {
      background: var(--primary-light, rgba(16, 185, 129, 0.08));
      color: var(--primary-color, #059669);
    }

    .settings-tab:hover:not(.active) {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .tab-pane {
      display: none;
      animation: fadeIn .15s ease-out;
    }

    .tab-pane.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(2px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ===== Mise en page interne ===== */

    .form-row-inline {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    @media (max-width: 640px) {
      .form-row-inline {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .settings-hint {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .pill-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
    }

    .stripe-pill-loading {
      background: rgba(148, 163, 184, 0.15);
      color: #475569;
    }

    .stripe-pill-ok {
      background: rgba(34, 197, 94, 0.12);
      color: #166534;
    }

    .stripe-pill-warn {
      background: rgba(249, 115, 22, 0.15);
      color: #9a3412;
    }

    .stripe-pill-error {
      background: rgba(250, 204, 21, 0.18);
      color: #854d0e;
    }

    .save-status-inline {
      margin-top: 8px;
      font-size: 12px;
      color: #059669;
      min-height: 18px;
    }
  </style>
</head>
<body data-page="settings-account">
  <!-- MOBILE HEADER -->
  <div class="mobile-header">
    <a href="/app.html" class="mobile-logo">
      <i class="fas fa-calendar-check"></i>
      <span class="mobile-logo-text">Bookingmanage</span>
    </a>
    <button class="mobile-menu-btn" id="mobileMenuBtn">
      <i class="fas fa-bars"></i>
    </button>
  </div>
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <div class="app-container">
    
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <a href="/" class="sidebar-logo">
          <i class="fas fa-calendar-check"></i>
          <div class="sidebar-logo-text">
            <span class="sidebar-logo-title">Bookingmanage</span>
            <span class="sidebar-logo-subtitle">Property Manager</span>
          </div>
        </a>
      </div>
      
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Principal</div>
          <a href="/app.html" class="nav-item" data-page="settings-account" data-page="app">
            <i class="fas fa-th-large"></i>
            <span>Dashboard</span>
          </a>
          <a href="/app.html#calendarSection" class="nav-item">
            <i class="fas fa-calendar"></i>
            <span>Calendrier</span>
            <span class="nav-badge" id="navTotalReservations">0</span>
          </a>
          <a href="/messages.html" class="nav-item" data-page="settings-account" data-page="messages">
            <i class="fas fa-comment-dots"></i>
            <span>Messages</span>
          </a>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Gestion</div>
          <a href="/settings.html" class="nav-item" data-page="settings">
            <i class="fas fa-home"></i>
            <span>Mes logements</span>
          </a>
          <a href="/welcome.html" class="nav-item" data-page="welcome">
            <i class="fas fa-book-open"></i>
            <span>Livret d'accueil</span>
          </a>
          <a href="/statistics.html" class="nav-item" data-page="statistics">
            <i class="fas fa-chart-bar"></i>
            <span>Statistiques</span>
          </a>
          <a href="/notifications.html" class="nav-item" data-page="notifications">
            <i class="fas fa-bell"></i>
            <span>Notifications</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Paramètres</div>
          <a href="/settings-account.html" class="nav-item active" data-page="settings-account">
            <i class="fas fa-cog"></i>
            <span>Paramètres</span>
          </a>
          <a href="/help.html" class="nav-item" data-page="settings-account" data-page="help">
            <i class="fas fa-question-circle"></i>
            <span>Aide</span>
          </a>
        </div>
      </nav>
      
      <div class="sidebar-footer">
        <div class="user-profile">
          <div class="user-avatar" id="sidebarUserAvatar">C</div>
          <div class="user-info">
            <div class="user-name" id="sidebarUserName">Utilisateur</div>
            <div class="user-email" id="sidebarUserCompany">Mon espace</div>
          </div>

          <button class="btn btn-ghost btn-xs" id="logoutBtn"><i class="fas fa-sign-out-alt"></i></button>
        </div>
      </div>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
      
      <!-- Header -->
      <header class="main-header">
        <div class="header-left">
          <div class="page-kicker">Configuration</div>
          <h1 class="page-title">Paramètres du compte</h1>
          <p class="page-subtitle">
            Gérez vos informations de profil, votre conciergerie, vos préférences d’affichage et vos connexions de paiement.
          </p>
        </div>
      </header>
      
      <!-- Page Content -->
      <div class="page-content">

        <!-- Onglets -->
        <div class="settings-tabs">
          <button class="settings-tab active" data-tab="profile">
            <i class="fas fa-user"></i>
            Profil & entreprise
          </button>
          <button class="settings-tab" data-tab="display">
            <i class="fas fa-moon"></i>
            Affichage
          </button>
          <button class="settings-tab" data-tab="payments">
            <i class="fas fa-credit-card"></i>
            Paiements & Stripe
          </button>
          <button class="settings-tab" data-tab="notifications">
            <i class="fas fa-bell"></i>
            Notifications
          </button>
        </div>

        <!-- Onglet : Profil -->
        <div class="tab-pane active" id="tab-profile" data-tab="profile">
          <section class="card mb-lg">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-user"></i>
                Profil & entreprise
              </div>
            </div>
            <div class="card-body">
              <form class="form-grid">
                <div class="form-row-inline">
                  <div class="form-row">
                    <label for="profileFirstName">Prénom</label>
                    <input type="text" id="profileFirstName" placeholder="Votre prénom">
                  </div>
                  <div class="form-row">
                    <label for="profileLastName">Nom</label>
                    <input type="text" id="profileLastName" placeholder="Votre nom">
                  </div>
                </div>

                <div class="form-row">
                  <label for="profileCompany">Nom de la conciergerie</label>
                  <input type="text" id="profileCompany" placeholder="La Conciergerie de Charles">
                  <p class="settings-hint">
                    Ce nom apparaîtra dans le header, la sidebar et dans certains messages générés.
                  </p>
                </div>

                <div class="form-row">
                  <label for="profileEmail">Email</label>
                  <input type="email" id="profileEmail" placeholder="vous@exemple.com">
                </div>

                <div class="form-actions" style="margin-top: 16px; display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
                  <button type="button" class="btn btn-primary" id="saveProfileBtn">
                    <i class="fas fa-save"></i>
                    Enregistrer le profil
                  </button>
                  <span class="save-status-inline" id="profileSaveStatus"></span>
                </div>
              </form>
            </div>
          </section>
        </div>

        <!-- Onglet : Affichage -->
        <div class="tab-pane" id="tab-display" data-tab="display">
          <section class="card mb-lg">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-moon"></i>
                Préférences d’affichage
              </div>
            </div>
            <div class="card-body">
              <div class="form-row">
                <label for="themePreference">Thème</label>
                <select id="themePreference">
                  <option value="light">Clair</option>
                  <option value="dark">Sombre</option>
                  <option value="system">Selon le système</option>
                </select>
                <p class="settings-hint">
                  Le thème est appliqué sur tout le Bookingmanage (dashboard, calendrier, etc.).
                </p>
              </div>
              <div class="form-actions" style="margin-top: 16px; display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
                <button type="button" class="btn btn-ghost" id="applyThemeBtn">
                  Appliquer & enregistrer
                </button>
                <span class="save-status-inline" id="themeSaveStatus"></span>
              </div>
            </div>
          </section>
        </div>

        <!-- Onglet : Paiements & Stripe -->
        <div class="tab-pane" id="tab-payments" data-tab="payments">
          <section class="card mb-lg">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-credit-card"></i>
                Paiements & Stripe
              </div>
            </div>
            <div class="card-body">
              <p class="page-subtitle" style="margin-bottom: 12px;">
                Connectez votre propre compte Stripe pour encaisser directement les cautions de vos voyageurs, sans intermédiaire.
              </p>

              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                <span id="stripeStatus" class="pill-status stripe-pill-loading">
                  <i class="fas fa-spinner fa-spin"></i>
                  Chargement du statut...
                </span>
                <small style="color: var(--text-secondary, #6b7280);">
                  Statut de connexion Stripe pour cet espace.
                </small>
              </div>

              <div class="form-actions" style="margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap;">
                <button type="button" class="btn btn-primary" id="connectStripeBtn">
                  <i class="fas fa-plug"></i>
                  <span>Connecter mon compte Stripe</span>
                </button>

                <button type="button" class="btn btn-ghost" id="manageStripeBtn" style="display: none;">
                  <i class="fas fa-external-link-alt"></i>
                  <span>Gérer mon compte Stripe</span>
                </button>
              </div>

              <p style="margin-top: 10px; font-size: 12px; color: var(--text-secondary, #6b7280);">
                Vous serez redirigé vers Stripe pour créer ou connecter votre compte. Une fois terminé, les cautions créées
                dans Bookingmanage seront encaissées sur ce compte Stripe, et non sur celui de la plateforme.
              </p>
            </div>
          </section>
        </div>

        <!-- Onglet : Notifications -->
        <div class="tab-pane" id="tab-notifications" data-tab="notifications">
          <section class="card">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-bell"></i>
                Notifications générales
              </div>
            </div>
            <div class="card-body">
              <div class="form-row">
                <label>
                  <input type="checkbox" id="notifNewReservation" checked>
                  Recevoir une notification pour chaque nouvelle réservation
                </label>
                <p class="settings-hint">
                  Utilisé pour alimenter le module Notifications et certains rappels dans le dashboard.
                </p>
              </div>
              <div class="form-row">
                <label>
                  <input type="checkbox" id="notifReminder">
                  Rappels la veille d’une arrivée
                </label>
                <p class="settings-hint">
                  Permet de recevoir un rappel de type “Arrivée demain” pour vos séjours à venir.
                </p>
              </div>
              <div class="form-actions" style="margin-top: 16px; display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
                <button type="button" class="btn btn-primary" id="saveNotifBtn">
                  Enregistrer les préférences
                </button>
                <span class="save-status-inline" id="notifSaveStatus"></span>
              </div>
            </div>
          </section>
        </div>

      </div>
    </main>
  </div>

  <!-- Script auth + user + logout -->
  <script>
    (function () {
      const token = localStorage.getItem('lcc_token');
      if (!token) {
        window.location.href = '/login.html';
        return;
      }

      const rawUser = localStorage.getItem('lcc_user');
      let user = null;

      try {
        user = rawUser ? JSON.parse(rawUser) : null;
      } catch (e) {
        console.error('Impossible de lire lcc_user', e);
      }

      window.addEventListener('DOMContentLoaded', () => {
        if (user) {
          const nameEl = document.getElementById('sidebarUserName');
          const companyEl = document.getElementById('sidebarUserCompany');
          const avatarEl = document.getElementById('sidebarUserAvatar');

          if (nameEl) {
            nameEl.textContent = user.firstName
              ? user.firstName + (user.lastName ? ' ' + user.lastName : '')
              : (user.email || 'Mon compte');
          }

          if (companyEl) {
            companyEl.textContent = user.company || 'Mon espace';
          }

          if (avatarEl) {
            const initial = (user.firstName || user.email || '?').trim()[0] || 'U';
            avatarEl.textContent = initial.toUpperCase();
          }
        }

        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', function () {
            localStorage.removeItem('lcc_token');
            localStorage.removeItem('lcc_user');
            window.location.href = '/login.html';
          });
        }
      });
    })();
  </script>

  <!-- Script paramètres (profil + thème + notifications + Stripe + tabs) -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      /* -------- TABS -------- */
      const tabButtons = Array.from(document.querySelectorAll('.settings-tab'));
      const tabPanes   = Array.from(document.querySelectorAll('.tab-pane'));

      function activateTab(tabName) {
        tabButtons.forEach(btn => {
          btn.classList.toggle('active', btn.dataset.tab === tabName);
        });
        tabPanes.forEach(pane => {
          pane.classList.toggle('active', pane.dataset.tab === tabName);
        });
      }

      tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const name = btn.dataset.tab;
          activateTab(name);
        });
      });

      /* -------- PROFIL & ENTREPRISE -------- */

      const firstNameInput = document.getElementById('profileFirstName');
      const lastNameInput  = document.getElementById('profileLastName');
      const companyInput   = document.getElementById('profileCompany');
      const emailInput     = document.getElementById('profileEmail');
      const saveProfileBtn = document.getElementById('saveProfileBtn');
      const profileSaveStatus = document.getElementById('profileSaveStatus');

      const savedProfileRaw = localStorage.getItem('lcc_settings_profile');
      if (savedProfileRaw) {
        try {
          const savedProfile = JSON.parse(savedProfileRaw);
          if (savedProfile.firstName) firstNameInput.value = savedProfile.firstName;
          if (savedProfile.lastName)  lastNameInput.value  = savedProfile.lastName;
          if (savedProfile.company)   companyInput.value   = savedProfile.company;
          if (savedProfile.email)     emailInput.value     = savedProfile.email;
        } catch (e) {
          console.error('Erreur lecture profil paramètres', e);
        }
      } else {
        const rawUser = localStorage.getItem('lcc_user');
        if (rawUser) {
          try {
            const u = JSON.parse(rawUser);
            if (u.firstName) firstNameInput.value = u.firstName;
            if (u.lastName)  lastNameInput.value  = u.lastName;
            if (u.company)   companyInput.value   = u.company;
            if (u.email)     emailInput.value     = u.email;
          } catch {}
        }
      }

      if (saveProfileBtn) {
        saveProfileBtn.addEventListener('click', function () {
          const data = {
            firstName: firstNameInput.value.trim(),
            lastName:  lastNameInput.value.trim(),
            company:   companyInput.value.trim(),
            email:     emailInput.value.trim()
          };

          localStorage.setItem('lcc_settings_profile', JSON.stringify(data));

          const rawUser = localStorage.getItem('lcc_user');
          let user = {};
          try {
            user = rawUser ? JSON.parse(rawUser) : {};
          } catch {
            user = {};
          }
          if (data.firstName) user.firstName = data.firstName;
          if (data.lastName)  user.lastName  = data.lastName;
          if (data.company)   user.company   = data.company;
          if (data.email)     user.email     = data.email;

          localStorage.setItem('lcc_user', JSON.stringify(user));

          if (profileSaveStatus) {
            profileSaveStatus.textContent = 'Profil enregistré.';
            setTimeout(() => { profileSaveStatus.textContent = ''; }, 2500);
          } else {
            alert('Profil enregistré');
          }

          window.setTimeout(() => window.location.reload(), 300);
        });
      }

      /* -------- PRÉFÉRENCES D’AFFICHAGE (THÈME) -------- */

      const themeSelect = document.getElementById('themePreference');
      const applyThemeBtn = document.getElementById('applyThemeBtn');
      const themeSaveStatus = document.getElementById('themeSaveStatus');

      function applyTheme(mode) {
        const root = document.documentElement;
        if (mode === 'system') {
          const prefersDark = window.matchMedia &&
            window.matchMedia('(prefers-color-scheme: dark)').matches;
          root.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
        } else if (mode === 'dark') {
          root.setAttribute('data-theme', 'dark');
        } else {
          root.setAttribute('data-theme', 'light');
        }
      }

      const savedTheme = localStorage.getItem('lcc_theme');
      if (savedTheme && themeSelect) {
        themeSelect.value = savedTheme;
        applyTheme(savedTheme);
      }

      if (applyThemeBtn && themeSelect) {
        applyThemeBtn.addEventListener('click', function () {
          const value = themeSelect.value;
          localStorage.setItem('lcc_theme', value);
          applyTheme(value);
          if (themeSaveStatus) {
            themeSaveStatus.textContent = 'Préférence de thème enregistrée.';
            setTimeout(() => { themeSaveStatus.textContent = ''; }, 2500);
          } else {
            alert('Préférence de thème enregistrée');
          }
        });
      }

      /* -------- NOTIFICATIONS -------- */

      const notifNewReservation = document.getElementById('notifNewReservation');
      const notifReminder       = document.getElementById('notifReminder');
      const saveNotifBtn        = document.getElementById('saveNotifBtn');
      const notifSaveStatus     = document.getElementById('notifSaveStatus');

      const savedNotifRaw = localStorage.getItem('lcc_settings_notif');
      if (savedNotifRaw) {
        try {
          const savedNotif = JSON.parse(savedNotifRaw);
          if (typeof savedNotif.newReservation === 'boolean') {
            notifNewReservation.checked = savedNotif.newReservation;
          }
          if (typeof savedNotif.reminder === 'boolean') {
            notifReminder.checked = savedNotif.reminder;
          }
        } catch (e) {
          console.error('Erreur lecture notifs paramètres', e);
        }
      }

      if (saveNotifBtn) {
        saveNotifBtn.addEventListener('click', function () {
          const data = {
            newReservation: notifNewReservation.checked,
            reminder: notifReminder.checked
          };
          localStorage.setItem('lcc_settings_notif', JSON.stringify(data));
          if (notifSaveStatus) {
            notifSaveStatus.textContent = 'Préférences de notifications enregistrées.';
            setTimeout(() => { notifSaveStatus.textContent = ''; }, 2500);
          } else {
            alert('Préférences de notifications enregistrées');
          }
        });
      }

      /* -------- STRIPE CONNECT -------- */

      const stripeStatusEl   = document.getElementById('stripeStatus');
      const connectStripeBtn = document.getElementById('connectStripeBtn');
      const manageStripeBtn  = document.getElementById('manageStripeBtn');

      async function refreshStripeStatus() {
        if (!stripeStatusEl) return;

        const token = localStorage.getItem('lcc_token');
        if (!token) {
          stripeStatusEl.textContent = 'Non connecté (session expirée)';
          stripeStatusEl.className   = 'pill-status stripe-pill-warn';
          return;
        }

        try {
          const res = await fetch('/api/stripe/status', {
            headers: {
              'Authorization': 'Bearer ' + token
            }
          });

          if (!res.ok) {
            throw new Error('Erreur statut Stripe');
          }

          const data = await res.json();

          if (data.connected) {
            stripeStatusEl.textContent = 'Compte Stripe connecté';
            stripeStatusEl.className   = 'pill-status stripe-pill-ok';

            if (manageStripeBtn) {
              manageStripeBtn.style.display = 'inline-flex';
            }
            if (connectStripeBtn) {
              connectStripeBtn.querySelector('span').textContent =
                'Reconnecter / compléter mon compte Stripe';
            }
          } else {
            stripeStatusEl.textContent = 'Aucun compte Stripe connecté';
            stripeStatusEl.className   = 'pill-status stripe-pill-warn';

            if (manageStripeBtn) {
              manageStripeBtn.style.display = 'none';
            }
            if (connectStripeBtn) {
              connectStripeBtn.querySelector('span').textContent =
                'Connecter mon compte Stripe';
            }
          }
        } catch (e) {
          console.error(e);
          stripeStatusEl.textContent = 'Erreur lors du chargement de Stripe';
          stripeStatusEl.className   = 'pill-status stripe-pill-error';
        }
      }

      if (connectStripeBtn) {
        connectStripeBtn.addEventListener('click', async () => {
          const token = localStorage.getItem('lcc_token');
          if (!token) {
            alert("Votre session a expiré, veuillez vous reconnecter.");
            window.location.href = '/login.html';
            return;
          }

          try {
            connectStripeBtn.disabled = true;
            connectStripeBtn.querySelector('span').textContent = 'Redirection vers Stripe...';

            const res = await fetch('/api/stripe/create-onboarding-link', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
              }
            });

            const data = await res.json();

            if (data.url) {
              window.location.href = data.url;
            } else {
              alert(data.error || "Impossible de générer le lien Stripe.");
            }
          } catch (e) {
            console.error(e);
            alert("Erreur lors de la communication avec Stripe.");
          } finally {
            connectStripeBtn.disabled = false;
            const label = manageStripeBtn && manageStripeBtn.style.display === 'inline-flex'
              ? 'Reconnecter / compléter mon compte Stripe'
              : 'Connecter mon compte Stripe';
            connectStripeBtn.querySelector('span').textContent = label;
          }
        });
      }

      if (manageStripeBtn) {
        manageStripeBtn.addEventListener('click', () => {
          if (connectStripeBtn) {
            connectStripeBtn.click();
          }
        });
      }

      refreshStripeStatus();
    });
  </script>

  <!-- MOBILE MENU SCRIPT -->
  <script>
    (function() {
      const menuBtn = document.getElementById('mobileMenuBtn');
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      
      if (menuBtn && sidebar && overlay) {
        menuBtn.addEventListener('click', function() {
          sidebar.classList.toggle('active');
          overlay.classList.toggle('active');
          
          const icon = menuBtn.querySelector('i');
          if (sidebar.classList.contains('active')) {
            icon.classList.remove('fa-bars');
            icon.classList.add('fa-times');
          } else {
            icon.classList.remove('fa-times');
            icon.classList.add('fa-bars');
          }
        });
        
        overlay.addEventListener('click', function() {
          sidebar.classList.remove('active');
          overlay.classList.remove('active');
          const icon = menuBtn.querySelector('i');
          icon.classList.remove('fa-times');
          icon.classList.add('fa-bars');
        });
        
        if (window.innerWidth <= 1024) {
          document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
              sidebar.classList.remove('active');
              overlay.classList.remove('active');
              const icon = menuBtn.querySelector('i');
              icon.classList.remove('fa-times');
              icon.classList.add('fa-bars');
            });
          });
        }
      }
    })();
    
    (function() {
      const currentPage = document.body.getAttribute('data-page');
      if (currentPage) {
        document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.remove('active');
        });
        const activeLink = document.querySelector('.nav-item[data-page="settings-account"]');
        if (activeLink) {
          activeLink.classList.add('active');
        }
      }
    })();
    
    document.getElementById('logoutBtn')?.addEventListener('click', function() {
      localStorage.removeItem('lcc_token');
      localStorage.removeItem('lcc_user');
      window.location.href = '/login.html';
    });
    
    (function() {
      const user = JSON.parse(localStorage.getItem('lcc_user') || '{}');
      if (user.firstName) {
        const nameEl = document.getElementById('sidebarUserName');
        const avatarEl = document.getElementById('sidebarUserAvatar');
        if (nameEl) nameEl.textContent = user.firstName + ' ' + (user.lastName || '');
        if (avatarEl) avatarEl.textContent = user.firstName.charAt(0).toUpperCase();
      }
      if (user.company) {
        const companyEl = document.getElementById('sidebarUserCompany');
        if (companyEl) companyEl.textContent = user.company;
      }
    })();
  </script>
</body>
</html>
