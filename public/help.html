<!DOCTYPE html>
<html data-theme="light" lang="fr" data-theme-v3="1">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport"/>
<title>Boostinghost ‚Äì Aide</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
<link href="/css/style.css" rel="stylesheet"/>
<link href="/css/bh-theme-v3.css" rel="stylesheet"/>
<link href="/css/bh-shared.css?v=1" rel="stylesheet"/>
<link href="/css/bottom-bar-enhanced.css" rel="stylesheet"/>
<link href="/css/tablet-bottom-bar-fix.css" rel="stylesheet"/>  
<link href="/css/menu-plus-fixes.css" rel="stylesheet"/>
<link href="/css/menu-active-button.css" rel="stylesheet"/>
<link rel="stylesheet" href="/css/messages-badge-red.css">
<link rel="stylesheet" href="/css/messages-badge-desktop.css">
<style>
  html, body { margin: 0 !important; }
  .app-container { margin-top: 0 !important; }
  .page-content { margin-top: 0 !important; max-width: 960px; }
  html { scroll-behavior: smooth; }

  /* ====== HEADER ====== */
  .main-header {
    display: flex; align-items: flex-start; justify-content: space-between; gap: 16px;
    padding: 18px 20px; margin-bottom: 20px; border-radius: 20px;
    background: linear-gradient(135deg, rgba(15,23,42,0.98), rgba(15,23,42,0.92));
    border: 1px solid rgba(148,163,184,0.45);
    box-shadow: 0 24px 60px rgba(15,23,42,0.7);
  }
  [data-theme="light"] .main-header {
    background: linear-gradient(135deg, #f9fafb, #eff6ff);
    border-color: rgba(148,163,184,0.4);
    box-shadow: 0 18px 40px rgba(15,23,42,0.06);
  }
  .header-left { max-width: 70%; }
  .page-kicker { font-size: 11px; text-transform: uppercase; letter-spacing: 0.18em; color: #9ca3af; margin-bottom: 4px; font-weight: 600; }
  .page-title { margin: 0; font-size: 24px; font-weight: 700; }
  .page-subtitle { margin-top: 6px; font-size: 13px; color: #9ca3af; }
  [data-theme="light"] .page-subtitle { color: #6b7280; }
  @media (max-width: 768px) {
    .main-header { flex-direction: column; align-items: flex-start; }
    .header-left { max-width: 100%; }
  }

  /* ====== FAQ ====== */
  .faq-item { border-radius: 12px; border: 1px solid var(--border-color); margin-bottom: 10px; overflow: hidden; background: var(--bg-secondary); }
  .faq-question { width: 100%; text-align: left; padding: 10px 12px; font-weight: 600; background: transparent; border: none; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-size: 14px; color: var(--text-primary); }
  .faq-answer { max-height: 0; overflow: hidden; padding: 0 12px; transition: max-height 0.2s ease, padding 0.2s ease; font-size: 14px; }
  .faq-item.open .faq-answer { max-height: 500px; padding: 8px 12px 12px; }
  .faq-toggle-icon { font-size: 12px; color: var(--text-secondary); margin-left: 8px; }
  #faqSearch { width: 100%; padding: 8px 10px; border-radius: 8px; border: 1px solid var(--border-color); font-size: 14px; box-sizing: border-box; background: var(--bg-primary); color: var(--text-primary); }
  .card.mb-lg { margin-bottom: 20px; }

  /* ====== SUPPORT CHAT ====== */
  .support-status-badge {
    display: inline-flex; align-items: center; gap: 6px;
    font-size: 11px; font-weight: 600; padding: 4px 10px;
    border-radius: 999px; background: rgba(16,185,129,0.1); color: #059669;
  }
  .support-status-badge i { font-size: 7px; }

  .support-chat-container {
    display: flex; flex-direction: column; height: 460px;
    border-top: 1px solid var(--border-color);
  }

  .support-messages {
    flex: 1; overflow-y: auto; padding: 16px;
    display: flex; flex-direction: column; gap: 12px;
    background: var(--bg-secondary);
  }

  .support-loading {
    text-align: center; padding: 40px; color: var(--text-secondary); font-size: 14px;
  }

  /* Bulles de messages */
  .support-msg { display: flex; gap: 10px; max-width: 85%; animation: supportFadeIn 0.2s ease; }
  .support-msg.user { align-self: flex-end; flex-direction: row-reverse; }
  .support-msg.admin { align-self: flex-start; }

  @keyframes supportFadeIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .support-msg-avatar {
    width: 32px; height: 32px; border-radius: 50%; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: 700; color: white;
  }
  .support-msg.admin .support-msg-avatar { background: linear-gradient(135deg, #059669, #10b981); }
  .support-msg.user .support-msg-avatar { background: linear-gradient(135deg, #3b82f6, #6366f1); }

  .support-msg-content { display: flex; flex-direction: column; gap: 4px; }
  .support-msg-sender { font-size: 11px; font-weight: 600; color: var(--text-secondary); }
  .support-msg.user .support-msg-sender { text-align: right; }

  .support-msg-bubble {
    padding: 10px 14px; border-radius: 14px; font-size: 14px; line-height: 1.5;
    word-wrap: break-word; white-space: pre-wrap; box-shadow: 0 1px 2px rgba(0,0,0,0.06);
  }
  .support-msg.admin .support-msg-bubble {
    background: var(--bg-primary); border: 1px solid var(--border-color);
    border-bottom-left-radius: 4px; color: var(--text-primary);
  }
  .support-msg.user .support-msg-bubble {
    background: #3b82f6; color: white; border-bottom-right-radius: 4px;
  }

  .support-msg-bubble img {
    max-width: 240px; max-height: 200px; border-radius: 8px; cursor: pointer;
    display: block; margin-top: 6px;
  }

  .support-msg-time { font-size: 10px; color: var(--text-secondary); }
  .support-msg.user .support-msg-time { text-align: right; }

  /* Zone date */
  .support-date-separator {
    text-align: center; font-size: 11px; color: var(--text-secondary);
    padding: 4px 12px; margin: 4px 0;
  }

  /* Zone de saisie */
  .support-input-area {
    border-top: 1px solid var(--border-color); background: var(--bg-primary); padding: 12px;
  }

  .support-input-row {
    display: flex; align-items: center; gap: 8px;
  }

  .support-input {
    flex: 1; padding: 10px 14px; border-radius: 20px; border: 1px solid var(--border-color);
    font-size: 14px; outline: none; background: var(--bg-secondary); color: var(--text-primary);
    transition: border-color 0.2s;
  }
  .support-input:focus { border-color: #3b82f6; }

  .support-btn-attach, .support-btn-send {
    width: 40px; height: 40px; border-radius: 50%; border: none; cursor: pointer;
    display: flex; align-items: center; justify-content: center; font-size: 16px;
    transition: all 0.2s;
  }
  .support-btn-attach { background: var(--bg-secondary); color: var(--text-secondary); }
  .support-btn-attach:hover { background: var(--border-color); color: var(--text-primary); }
  .support-btn-send { background: #3b82f6; color: white; }
  .support-btn-send:hover { background: #2563eb; transform: scale(1.05); }

  .support-image-preview {
    position: relative; padding: 8px 0; margin-bottom: 8px;
  }
  .support-image-preview img {
    max-height: 120px; border-radius: 8px; border: 1px solid var(--border-color);
  }
  .support-image-remove {
    position: absolute; top: 4px; left: 76px; width: 22px; height: 22px;
    border-radius: 50%; background: #ef4444; color: white; border: none;
    cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center;
  }

  /* Fullscreen image modal */
  .support-img-modal {
    display: none; position: fixed; inset: 0; z-index: 9999;
    background: rgba(0,0,0,0.85); align-items: center; justify-content: center; cursor: pointer;
  }
  .support-img-modal.active { display: flex; }
  .support-img-modal img { max-width: 90%; max-height: 90%; border-radius: 8px; }

  @media (max-width: 768px) {
    .support-chat-container { height: 380px; }
    .support-msg { max-width: 92%; }
  }
/* ============================================================
   DARK BAR + STICKY HEADER (identical to app.html)
   ============================================================ */
html[data-theme-v3="1"] body { padding-top: 40px !important; }
html[data-theme-v3="1"] .sidebar {
  position: fixed !important; top: 40px !important;
  left: 0 !important; bottom: 0 !important;
  height: auto !important;
  z-index: 30 !important;
}
html[data-theme-v3="1"] header.main-header {
  position: sticky !important;
  top: 0 !important;
  z-index: 50 !important;
  margin-top: 0 !important;
}
html[data-theme-v3="1"] main.main-content {
  padding-top: 0 !important;
  margin-top: 0 !important;
  position: relative !important;
  z-index: 35 !important;
}
html[data-theme-v3="1"] .app-container {
  margin-top: 0 !important;
  padding-top: 0 !important;
}
/* Tuer tout espace parasite entre barre dark et header */
html[data-theme-v3="1"] main.main-content > header.main-header {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

/* ‚îÄ‚îÄ BARRE DARK EN HAUT ‚îÄ‚îÄ */
html[data-theme-v3="1"] .bh-demo-nav {
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 9999;
  background: #0D1117;
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 0 16px;
  height: 40px;
  font-family: 'DM Sans', sans-serif;
  font-size: 12px;
  /* Pour le centrage absolu des badges */
  position: fixed;
}
html[data-theme-v3="1"] .bh-demo-nav .bh-demo-label {
  color: rgba(255,255,255,.4);
  font-weight: 500;
  margin-right: 6px;
  letter-spacing: .08em;
  text-transform: uppercase;
  font-size: 11px;
  white-space: nowrap;
}
html[data-theme-v3="1"] .bh-demo-nav a.bh-demo-btn,
html[data-theme-v3="1"] .bh-demo-nav .bh-demo-btn {
  padding: 4px 13px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.15);
  background: transparent;
  color: rgba(255,255,255,.6);
  cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  font-size: 11.5px;
  font-weight: 500;
  transition: all .2s;
  display: inline-flex;
  align-items: center;
  gap: 5px;
  text-decoration: none;
  white-space: nowrap;
}
html[data-theme-v3="1"] .bh-demo-nav a.bh-demo-btn:hover,
html[data-theme-v3="1"] .bh-demo-nav .bh-demo-btn:hover {
  background: rgba(255,255,255,.1);
  color: white;
}
html[data-theme-v3="1"] .bh-demo-nav a.bh-demo-btn.active,
html[data-theme-v3="1"] .bh-demo-nav .bh-demo-btn.active {
  background: #1A7A5E;
  color: white;
  border-color: #1A7A5E;
}
html[data-theme-v3="1"] .bh-demo-nav .bh-demo-right {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 10px;
  flex-shrink: 0;
}
html[data-theme-v3="1"] .bh-demo-nav .bh-demo-mode-label {
  color: rgba(255,255,255,.4);
  font-size: 10.5px;
  font-weight: 500;
  letter-spacing: .07em;
  text-transform: uppercase;
}
html[data-theme-v3="1"] .bh-theme-toggle {
  width: 44px;
  height: 24px;
  background: rgba(255,255,255,.15);
  border-radius: 999px;
  border: none;
  cursor: pointer;
  position: relative;
  transition: background .2s;
  flex-shrink: 0;
}
html[data-theme-v3="1"] .bh-theme-toggle::after {
  content: '';
  position: absolute;
  top: 3px; left: 3px;
  width: 18px; height: 18px;
  background: white;
  border-radius: 50%;
  transition: transform .2s;
}
html[data-theme-v3="1"][data-theme="dark"] .bh-theme-toggle { background: #1A7A5E; }
html[data-theme-v3="1"][data-theme="dark"] .bh-theme-toggle::after { transform: translateX(20px); }


/* ============================================================
   PAGE HELP ‚Äî V3
   ============================================================ */
html[data-theme-v3="1"],
html[data-theme-v3="1"] body {
  overflow: hidden !important;
  height: 100% !important;
  font-family: 'DM Sans', sans-serif !important;
  background: #F5F2EC !important;
}
html[data-theme-v3="1"] .app-container {
  height: calc(100vh - 40px) !important;
  overflow: hidden !important;
}
html[data-theme-v3="1"] main.main-content {
  overflow-y: auto !important;
  height: 100% !important;
  background: #F5F2EC !important;
  padding-top: 70px !important;
}
html[data-theme-v3="1"] header.main-header {
  position: fixed !important;
  top: 40px !important;
  left: 0 !important; right: 0 !important;
  z-index: 50 !important;
  margin-left: 260px !important;
}
@media(max-width:768px){
  html[data-theme-v3="1"] header.main-header { margin-left: 0 !important; }
}
html[data-theme-v3="1"] .sidebar { z-index: 30 !important; }
html[data-theme-v3="1"] .header-actions .btn-ghost { display: none !important; }

/* Back button */
.help-back-btn {
  display: inline-flex; align-items: center; gap: 8px;
  height: 40px; padding: 0 20px; border: none; border-radius: 12px;
  background: #1A7A5E; color: white; font-family: 'DM Sans', sans-serif;
  font-size: 14px; font-weight: 600; cursor: pointer; transition: background .15s;
  white-space: nowrap; position: fixed; top: calc(40px + 13px); right: 24px; z-index: 200;
}
.help-back-btn:hover { background: #15624B; }

/* Page content */
html[data-theme-v3="1"] .page-content {
  padding: 24px !important;
  max-width: none !important;
  margin: 0 !important;
  box-sizing: border-box !important;
}

/* Cards */
html[data-theme-v3="1"] .card {
  background: #F5F0E8 !important;
  border: 1px solid rgba(200,184,154,.4) !important;
  border-radius: 16px !important;
  box-shadow: none !important;
}
html[data-theme-v3="1"] .card-header {
  background: rgba(245,240,232,.8) !important;
  border-bottom: 1px solid rgba(200,184,154,.35) !important;
  border-radius: 16px 16px 0 0 !important;
}
html[data-theme-v3="1"] .card-title {
  font-family: 'DM Sans', sans-serif !important;
  font-weight: 700 !important; color: #0D1117 !important;
}

/* FAQ items */
html[data-theme-v3="1"] .faq-item {
  background: rgba(255,255,255,.5) !important;
  border-color: rgba(200,184,154,.4) !important;
  border-radius: 12px !important;
}
html[data-theme-v3="1"] .faq-question {
  font-family: 'DM Sans', sans-serif !important;
  font-weight: 600 !important;
}
html[data-theme-v3="1"] .faq-item.open {
  background: white !important;
}

/* Search input */
html[data-theme-v3="1"] input[type=text],
html[data-theme-v3="1"] input[type=search] {
  background: rgba(255,255,255,.7) !important;
  border-color: rgba(13,17,23,.12) !important;
  border-radius: 10px !important;
  font-family: 'DM Sans', sans-serif !important;
}
html[data-theme-v3="1"] input:focus {
  background: white !important;
  border-color: #1A7A5E !important;
  box-shadow: 0 0 0 3px rgba(26,122,94,.08) !important;
  outline: none !important;
}

/* Support chat */
html[data-theme-v3="1"] .support-chat-container {
  border-radius: 0 0 14px 14px !important;
  overflow: hidden !important;
}
html[data-theme-v3="1"] .support-messages {
  background: #FAFAF8 !important;
}
html[data-theme-v3="1"] .support-input-area {
  background: white !important;
  border-top: 1px solid rgba(200,184,154,.4) !important;
}
html[data-theme-v3="1"] .support-input {
  background: #F5F0E8 !important;
  border-color: rgba(13,17,23,.12) !important;
  border-radius: 10px !important;
  font-family: 'DM Sans', sans-serif !important;
}
html[data-theme-v3="1"] .support-input:focus {
  background: white !important;
  border-color: #1A7A5E !important;
  box-shadow: 0 0 0 3px rgba(26,122,94,.08) !important;
  outline: none !important;
}
html[data-theme-v3="1"] .support-btn-send {
  background: #1A7A5E !important;
  border-radius: 10px !important;
}
html[data-theme-v3="1"] .support-btn-send:hover { background: #15624B !important; }
html[data-theme-v3="1"] .support-btn-attach {
  color: #7A8695 !important;
  border-radius: 8px !important;
}
html[data-theme-v3="1"] .support-btn-attach:hover {
  background: rgba(13,17,23,.06) !important;
  color: #1A7A5E !important;
}
/* Support status badge */
html[data-theme-v3="1"] .support-status-badge {
  font-size: 12px !important;
  font-weight: 600 !important;
  color: #1A7A5E !important;
}

/* Bubble messages */
html[data-theme-v3="1"] .support-msg-bubble.user {
  background: #1A7A5E !important;
  border-radius: 14px 14px 4px 14px !important;
}
html[data-theme-v3="1"] .support-msg-bubble.support {
  background: white !important;
  border: 1px solid rgba(200,184,154,.4) !important;
  border-radius: 14px 14px 14px 4px !important;
}

/* ‚îÄ‚îÄ Masquer mobile-header en v3 desktop ‚îÄ‚îÄ */
html[data-theme-v3="1"] .mobile-header {
  display: none !important;
}
</style>
<script src="/js/auth-fetch.js"></script>
<link rel="stylesheet" href="/css/mobile-native-styles.css">
</head>
<body data-back-href="/app.html" data-back-label="Retour au dashboard" data-kicker="Support" data-page="help" data-subtitle="FAQ et chat avec le support." data-title="Centre d'aide">

<!-- Dark bar -->
<div class="bh-demo-nav" id="bhTopBar">
  <!-- Connexions centr√©es -->
  <div style="position:absolute;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:16px;">

    <!-- Airbnb -->
    <div style="display:flex;align-items:center;gap:7px;">
      <i class="fa-brands fa-airbnb" style="font-size:15px;color:#FF5A5F;"></i>
      <span style="color:rgba(255,255,255,.7);font-size:12px;font-weight:500;">Airbnb</span>
      <span id="topbar-status-airbnb" style="font-size:11px;font-weight:600;padding:2px 9px;border-radius:999px;background:rgba(239,68,68,.2);color:#F87171;border:1px solid rgba(239,68,68,.35);">
        <i class="fas fa-circle" style="font-size:7px;margin-right:3px;vertical-align:middle;"></i>Non connect√©
      </span>
    </div>

    <div style="width:1px;height:16px;background:rgba(255,255,255,.1);"></div>

    <!-- Booking.com -->
    <div style="display:flex;align-items:center;gap:7px;">
      <span style="font-size:13px;font-weight:800;color:#003580;">B.</span>
      <span style="color:rgba(255,255,255,.7);font-size:12px;font-weight:500;">Booking.com</span>
      <span id="topbar-status-booking" style="font-size:11px;font-weight:600;padding:2px 9px;border-radius:999px;background:rgba(239,68,68,.2);color:#F87171;border:1px solid rgba(239,68,68,.35);">
        <i class="fas fa-circle" style="font-size:7px;margin-right:3px;vertical-align:middle;"></i>Non connect√©
      </span>
    </div>

    <div style="width:1px;height:16px;background:rgba(255,255,255,.1);"></div>

    <!-- Stripe -->
    <div style="display:flex;align-items:center;gap:7px;">
      <i class="fa-brands fa-stripe-s" style="font-size:17px;color:#6772E5;"></i>
      <span style="color:rgba(255,255,255,.7);font-size:12px;font-weight:500;">Stripe</span>
      <span id="topbar-status-stripe" style="font-size:11px;font-weight:600;padding:2px 9px;border-radius:999px;background:rgba(239,68,68,.2);color:#F87171;border:1px solid rgba(239,68,68,.35);">
        <i class="fas fa-circle" style="font-size:7px;margin-right:3px;vertical-align:middle;"></i>Non connect√©
      </span>
    </div>

  </div>

  <!-- Toggle dark mode (droite) -->
  <div class="bh-demo-right">
    <span class="bh-demo-mode-label">Mode</span>
    <button class="bh-theme-toggle" id="bhThemeToggleDark" onclick="document.documentElement.getAttribute('data-theme')==='dark'?document.documentElement.setAttribute('data-theme','light'):document.documentElement.setAttribute('data-theme','dark')"></button>
  </div>
</div>

<script>
// Mise √† jour des statuts de connexion dans la top bar
(function updateTopBarStatus() {
  function setStatus(id, connected) {
    const el = document.getElementById(id);
    if (!el) return;
    if (connected) {
      el.style.background = 'rgba(34,197,94,.2)';
      el.style.color = '#4ADE80';
      el.style.borderColor = 'rgba(34,197,94,.35)';
      el.innerHTML = '<i class="fas fa-circle" style="font-size:7px;margin-right:3px;vertical-align:middle;"></i>Connect√©';
    } else {
      el.style.background = 'rgba(239,68,68,.2)';
      el.style.color = '#F87171';
      el.style.borderColor = 'rgba(239,68,68,.35)';
      el.innerHTML = '<i class="fas fa-circle" style="font-size:7px;margin-right:3px;vertical-align:middle;"></i>Non connect√©';
    }
  }

  function checkStatuses() {
    try {
      const reservations = JSON.parse(localStorage.getItem('LCC_RESERVATIONS') || '[]');
      const hasAirbnb = reservations.some(r =>
        (r.source || r.platform || '').toLowerCase().includes('airbnb')
      );
      const hasBooking = reservations.some(r =>
        (r.source || r.platform || '').toLowerCase().includes('booking')
      );
      setStatus('topbar-status-airbnb', hasAirbnb);
      setStatus('topbar-status-booking', hasBooking);

      // Stripe : v√©rifie lcc_user ou LCC_PROPERTIES
      const user = JSON.parse(localStorage.getItem('lcc_user') || '{}');
      const properties = JSON.parse(localStorage.getItem('LCC_PROPERTIES') || '[]');
      const hasStripe = !!(
        user.stripeAccountId ||
        user.stripe_account_id ||
        user.stripeConnected ||
        properties.some(p => p.stripeAccountId || p.stripe_account_id)
      );
      setStatus('topbar-status-stripe', hasStripe);
    } catch(e) {
      console.warn('TopBar status error:', e);
    }
  }

  // V√©rifier au chargement
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', checkStatuses);
  } else {
    checkStatuses();
  }

  // Re-v√©rifier apr√®s chargement des donn√©es API (d√©lai)
  setTimeout(checkStatuses, 2000);
  setTimeout(checkStatuses, 5000);

  // Exposer pour appel manuel apr√®s loadData
  window.updateTopBarStatus = checkStatuses;
})();
</script>


<!-- MOBILE HEADER -->
<div class="mobile-header">
<a class="mobile-logo" href="/app.html">
<i class="fas fa-calendar-check"></i>
<span class="mobile-logo-text">Bookingmanage</span>
</a>
<button class="mobile-menu-btn" id="mobileMenuBtn">
<i class="fas fa-bars"></i>
</button>
</div>
<div class="sidebar-overlay" id="sidebarOverlay"></div>
<div class="app-container">
<div id="bhSidebar"></div>
<main class="main-content"><div id="bhHeader"></div>
<button class="help-back-btn" onclick="window.location.href='/app.html'"><i class="fas fa-arrow-left"></i> Tableau de bord</button>
<div class="page-content">

<!-- Bloc FAQ -->
<section class="card mb-lg">
<div class="card-header">
<div class="card-title">
<i class="fas fa-circle-question"></i>
              Questions fr√©quentes
            </div>
</div>
<div class="card-body">
<div class="form-row" style="margin-bottom: 16px;">
<input id="faqSearch" placeholder="Rechercher une question..." type="text"/>
</div>
<div class="faq-item">
<button class="faq-question">
<span>üìÖ Comment synchroniser mes calendriers iCal ?</span>
<span class="faq-toggle-icon"><i class="fas fa-chevron-down"></i></span>
</button>
<div class="faq-answer">
<p>Allez dans <strong>Mes logements > Modifier</strong>, puis ajoutez ou mettez √† jour les URL iCal fournies par les plateformes (Airbnb, Booking, etc.). Ensuite, cliquez sur le bouton de <strong>synchronisation</strong> dans le Dashboard.</p>
</div>
</div>
<div class="faq-item">
<button class="faq-question">
<span>‚ûï Comment ajouter une r√©servation manuelle ?</span>
<span class="faq-toggle-icon"><i class="fas fa-chevron-down"></i></span>
</button>
<div class="faq-answer">
<p>Sur le Dashboard, cliquez sur <strong>Nouvelle r√©servation</strong>, remplissez les informations du s√©jour (logement, dates, nom du client) puis enregistrez.</p>
</div>
</div>
<div class="faq-item">
<button class="faq-question">
<span>üîî Comment fonctionnent les notifications ?</span>
<span class="faq-toggle-icon"><i class="fas fa-chevron-down"></i></span>
</button>
<div class="faq-answer">
<p>Le centre de notifications regroupe les nouveaux s√©jours d√©tect√©s. Vous pouvez ajuster vos pr√©f√©rences dans la page <strong>Param√®tres</strong>.</p>
</div>
</div>
<div class="faq-item">
<button class="faq-question">
<span>üë§ Comment modifier mes informations de compte ?</span>
<span class="faq-toggle-icon"><i class="fas fa-chevron-down"></i></span>
</button>
<div class="faq-answer">
<p>Rendez-vous dans la page <strong>Param√®tres</strong>, puis mettez √† jour votre nom, email ou nom de conciergerie.</p>
</div>
</div>
</div>
</section>

<!-- Bloc Chat Support -->
<section class="card mb-lg" id="supportSection">
<div class="card-header" style="display:flex; justify-content:space-between; align-items:center;">
<div class="card-title">
<i class="fas fa-comments"></i>
              Contacter le support
            </div>
<span id="supportStatus" class="support-status-badge">
<i class="fas fa-circle"></i> En ligne
</span>
</div>
<div class="card-body" style="padding: 0;">
<div class="support-chat-container" id="supportChatContainer">
<div class="support-messages" id="supportMessages">
<div class="support-loading"><i class="fas fa-spinner fa-spin"></i> Chargement...</div>
</div>
<div class="support-input-area">
<div class="support-image-preview" id="imagePreview" style="display: none;">
<img id="imagePreviewImg" src="" alt="Aper√ßu"/>
<button class="support-image-remove" onclick="removeImagePreview()"><i class="fas fa-times"></i></button>
</div>
<div class="support-input-row">
<button class="support-btn-attach" onclick="document.getElementById('supportImageInput').click()" title="Envoyer une image">
<i class="fas fa-image"></i>
</button>
<input type="file" id="supportImageInput" accept="image/*" style="display:none" onchange="handleImageSelect(event)"/>
<input type="text" id="supportInput" class="support-input" placeholder="√âcrivez votre message..." autocomplete="off"/>
<button class="support-btn-send" id="supportSendBtn" onclick="sendSupportMessage()">
<i class="fas fa-paper-plane"></i>
</button>
</div>
</div>
</div>
</div>
</section>

<!-- Bloc Ressources -->
<section class="card">
<div class="card-header">
<div class="card-title">
<i class="fas fa-book-open"></i>
              Ressources & guide
            </div>
</div>
<div class="card-body">
<p>Prochainement : un guide utilisateur d√©taill√© et des vid√©os tutoriels pour tirer le maximum de Boostinghost.</p>
</div>
</section>

</div>
</main>
</div>

<!-- Modal image fullscreen -->
<div class="support-img-modal" id="supportImgModal" onclick="this.classList.remove('active')">
<img id="supportImgModalImg" src="" alt=""/>
</div>

<!-- Auth check -->
<script>
(function () {
  const token = localStorage.getItem('lcc_token');
  if (!token) { window.location.href = '/login.html'; return; }
  const rawUser = localStorage.getItem('lcc_user');
  let user = null;
  try { user = rawUser ? JSON.parse(rawUser) : null; } catch (e) {}
  if (user) {
    const nameEl = document.getElementById('sidebarUserName');
    const companyEl = document.getElementById('sidebarUserCompany');
    const avatarEl = document.getElementById('sidebarUserAvatar');
    if (nameEl) nameEl.textContent = user.firstName ? user.firstName + (user.lastName ? ' ' + user.lastName : '') : (user.email || 'Mon compte');
    if (companyEl) companyEl.textContent = user.company || 'Mon espace';
    if (avatarEl) avatarEl.textContent = ((user.firstName || user.email || '?').trim()[0] || 'U').toUpperCase();
  }
  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) logoutBtn.addEventListener('click', function () {
    localStorage.removeItem('lcc_token'); localStorage.removeItem('lcc_user');
    window.location.href = '/login.html';
  });
})();
</script>

<!-- FAQ toggle -->
<script>
document.querySelectorAll('.faq-question').forEach(btn => {
  btn.addEventListener('click', () => {
    const item = btn.closest('.faq-item');
    item.classList.toggle('open');
  });
});

const faqSearch = document.getElementById('faqSearch');
if (faqSearch) {
  faqSearch.addEventListener('input', function() {
    const query = this.value.toLowerCase();
    document.querySelectorAll('.faq-item').forEach(item => {
      const text = item.textContent.toLowerCase();
      item.style.display = text.includes(query) ? '' : 'none';
    });
  });
}
</script>

<!-- Socket.io -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<!-- Support Chat Logic -->
<script>
const API_URL = window.location.origin;
let supportConversationId = null;
let supportSocket = null;
let selectedImageFile = null;

// ============================================
// INITIALISATION
// ============================================
async function initSupportChat() {
  const token = localStorage.getItem('lcc_token');
  if (!token) return;

  try {
    // R√©cup√©rer ou cr√©er la conversation
    const res = await fetch(`${API_URL}/api/support/conversation`, {
      headers: { 'Authorization': 'Bearer ' + token }
    });
    if (!res.ok) throw new Error('Erreur API');
    const data = await res.json();
    supportConversationId = data.conversation.id;

    // Charger les messages
    await loadSupportMessages();

    // Connecter Socket.io
    supportSocket = io(API_URL, { transports: ['websocket', 'polling'] });
    supportSocket.on('connect', () => {
      supportSocket.emit('join_support', supportConversationId);
    });
    supportSocket.on('support_message', (msg) => {
      // Ignorer nos propres messages (d√©j√† affich√©s en optimistic)
      if (msg.sender_type === 'user') return;
      
      appendSupportMessage(msg);
      scrollToBottom();
      markMessagesAsRead();
    });

  } catch (err) {
    console.error('Erreur init support:', err);
    document.getElementById('supportMessages').innerHTML = 
      '<div class="support-loading">Erreur de chargement. <a href="javascript:initSupportChat()">R√©essayer</a></div>';
  }
}

// ============================================
// CHARGER LES MESSAGES
// ============================================
async function loadSupportMessages() {
  const token = localStorage.getItem('lcc_token');
  const container = document.getElementById('supportMessages');

  const res = await fetch(`${API_URL}/api/support/messages/${supportConversationId}`, {
    headers: { 'Authorization': 'Bearer ' + token }
  });
  if (!res.ok) throw new Error('Erreur chargement messages');

  const data = await res.json();
  container.innerHTML = '';

  if (data.messages.length === 0) {
    container.innerHTML = '<div class="support-loading">Aucun message. Commencez la conversation !</div>';
    return;
  }

  let lastDate = '';
  data.messages.forEach(msg => {
    const msgDate = new Date(msg.created_at).toLocaleDateString('fr-FR');
    if (msgDate !== lastDate) {
      lastDate = msgDate;
      const sep = document.createElement('div');
      sep.className = 'support-date-separator';
      sep.textContent = msgDate === new Date().toLocaleDateString('fr-FR') ? "Aujourd'hui" : msgDate;
      container.appendChild(sep);
    }
    appendSupportMessage(msg, false);
  });

  scrollToBottom();
}

// ============================================
// AJOUTER UN MESSAGE AU DOM
// ============================================
function appendSupportMessage(msg, animate = true) {
  const container = document.getElementById('supportMessages');
  // Supprimer le placeholder
  const loading = container.querySelector('.support-loading');
  if (loading) loading.remove();

  const isUser = msg.sender_type === 'user';
  const div = document.createElement('div');
  div.className = `support-msg ${isUser ? 'user' : 'admin'}`;
  if (!animate) div.style.animation = 'none';

  const initial = isUser ? 'V' : 'üõü';
  const time = new Date(msg.created_at).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });

  let bubbleContent = escapeHtml(msg.message || '');
  // Rendre les URLs cliquables
  bubbleContent = bubbleContent.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" rel="noopener" style="color: inherit; text-decoration: underline; word-break: break-all;">$1</a>');

  if (msg.image_url) {
    bubbleContent += `<img src="${msg.image_url}" alt="Image" onclick="openImageModal('${msg.image_url}')" loading="lazy"/>`;
  }

  div.innerHTML = `
    <div class="support-msg-avatar">${initial}</div>
    <div class="support-msg-content">
      <div class="support-msg-sender">${isUser ? 'Vous' : (msg.sender_name || 'Support')}</div>
      <div class="support-msg-bubble">${bubbleContent}</div>
      <div class="support-msg-time">${time}</div>
    </div>
  `;

  container.appendChild(div);
}

function escapeHtml(text) {
  if (!text) return '';
  return text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

// ============================================
// ENVOYER UN MESSAGE
// ============================================
async function sendSupportMessage() {
  const input = document.getElementById('supportInput');
  const message = input.value.trim();

  // Si une image est s√©lectionn√©e, envoyer l'image
  if (selectedImageFile) {
    await uploadSupportImage();
    return;
  }

  if (!message || !supportConversationId) return;

  input.value = '';
  input.focus();

  // Afficher imm√©diatement (optimistic)
  appendSupportMessage({
    sender_type: 'user',
    message: message,
    created_at: new Date().toISOString()
  });
  scrollToBottom();

  try {
    const token = localStorage.getItem('lcc_token');
    const res = await fetch(`${API_URL}/api/support/messages`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + token
      },
      body: JSON.stringify({ conversationId: supportConversationId, message })
    });
    if (!res.ok) throw new Error('Erreur envoi');
  } catch (err) {
    console.error('Erreur envoi message:', err);
  }
}

// ============================================
// UPLOAD IMAGE
// ============================================
function handleImageSelect(event) {
  const file = event.target.files[0];
  if (!file) return;

  selectedImageFile = file;
  const reader = new FileReader();
  reader.onload = (e) => {
    document.getElementById('imagePreviewImg').src = e.target.result;
    document.getElementById('imagePreview').style.display = 'block';
  };
  reader.readAsDataURL(file);
}

function removeImagePreview() {
  selectedImageFile = null;
  document.getElementById('imagePreview').style.display = 'none';
  document.getElementById('imagePreviewImg').src = '';
  document.getElementById('supportImageInput').value = '';
}

async function uploadSupportImage() {
  if (!selectedImageFile || !supportConversationId) return;

  const formData = new FormData();
  formData.append('image', selectedImageFile);
  formData.append('conversationId', supportConversationId);

  // Afficher optimistic
  const tempUrl = document.getElementById('imagePreviewImg').src;
  appendSupportMessage({
    sender_type: 'user',
    message: 'üì∑ Image',
    image_url: tempUrl,
    created_at: new Date().toISOString()
  });
  scrollToBottom();

  removeImagePreview();

  try {
    const token = localStorage.getItem('lcc_token');
    await fetch(`${API_URL}/api/support/upload`, {
      method: 'POST',
      headers: { 'Authorization': 'Bearer ' + token },
      body: formData
    });
  } catch (err) {
    console.error('Erreur upload image:', err);
  }
}

// ============================================
// UTILS
// ============================================
function scrollToBottom() {
  const container = document.getElementById('supportMessages');
  setTimeout(() => { container.scrollTop = container.scrollHeight; }, 50);
}

function openImageModal(url) {
  document.getElementById('supportImgModalImg').src = url;
  document.getElementById('supportImgModal').classList.add('active');
}

async function markMessagesAsRead() {
  // Le GET messages marque d√©j√† comme lu c√¥t√© serveur
  // On refait un appel silencieux
  try {
    const token = localStorage.getItem('lcc_token');
    await fetch(`${API_URL}/api/support/messages/${supportConversationId}`, {
      headers: { 'Authorization': 'Bearer ' + token }
    });
  } catch (e) {}
}

// Envoyer avec Enter
document.addEventListener('DOMContentLoaded', () => {
  const input = document.getElementById('supportInput');
  if (input) {
    input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') { e.preventDefault(); sendSupportMessage(); }
    });
  }
  initSupportChat();
});
</script>

<script src="/js/bh-layout.js"></script>
<script src="/js/mobile-native-experience.js"></script>
<script src="/js/mobile-tabs-handler.js"></script>
<script src="/js/messages-badge-desktop-mobile.js"></script>
</body>
</html>
