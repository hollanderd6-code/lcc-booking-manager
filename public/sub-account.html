   <!DOCTYPE html>

<html data-theme="light" lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport"/>
<title>Boostinghost ‚Äì Param√®tres</title>
<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
<!-- CSS plateforme -->
<link href="/css/style.css" rel="stylesheet"/><link href="/css/bh-shared.css?v=1" rel="stylesheet"/><link href="/css/bottom-bar-enhanced.css" rel="stylesheet"/><link href="/css/menu-plus-fixes.css" rel="stylesheet"/><link href="/css/menu-active-button.css" rel="stylesheet"/>
<link href="/css/messages-badge-fix.css" rel="stylesheet"/>
<link rel="stylesheet" href="/css/messages-badge-red.css">
<link rel="stylesheet" href="/css/messages-badge-desktop.css">    
    <style>
    html, body {
      margin: 0 !important;
      }

    /* (patched) removed inline .main-content padding override for iOS safe-area */

    .page-content {
      margin-top: 0 !important;
      max-width: 960px;
    }

    .page-content section.card {
      margin-bottom: 20px;
    }

    /* ===== Onglets param√®tres ===== */

    .settings-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 16px;
    }

    .settings-tab {
      border: none;
      background: transparent;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background .12s ease, color .12s ease;
    }

    .settings-tab i {
      font-size: 13px;
    }

    .settings-tab.active {
      background: var(--primary-light, rgba(16, 185, 129, 0.08));
      color: var(--primary-color, #059669);
    }

    .settings-tab:hover:not(.active) {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    .tab-pane {
      display: none;
      animation: fadeIn .15s ease-out;
    }

    .tab-pane.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(2px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ===== Mise en page interne ===== */

    .form-row-inline {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    @media (max-width: 640px) {
      .form-row-inline {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .settings-hint {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .pill-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
    }

    .stripe-pill-loading {
      background: rgba(148, 163, 184, 0.15);
      color: #475569;
    }

    .stripe-pill-ok {
      background: rgba(34, 197, 94, 0.12);
      color: #166534;
    }

    .stripe-pill-warn {
      background: rgba(249, 115, 22, 0.15);
      color: #9a3412;
    }

    .stripe-pill-error {
      background: rgba(250, 204, 21, 0.18);
      color: #854d0e;
    }

    .save-status-inline {
      margin-top: 8px;
      font-size: 12px;
      color: #059669;
      min-height: 18px;
    }
    /* ===== Onglet Abonnement ===== */
    
    .subscription-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 1px solid var(--border-color);
    }

    .subscription-loading {
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
    }

    .subscription-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .subscription-info h3 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .subscription-status {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: var(--radius-full);
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    .status-badge.trial {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
    }

    .status-badge.active {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }

    .status-badge.expired {
      background: #fef2f2;
      color: #b91c1c;
      border: 1px solid #fecaca;
    }

    .days-remaining {
      font-size: 14px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .days-remaining i {
      color: var(--primary-color);
    }

    .subscription-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .subscription-details {
      display: grid;
      gap: 16px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
    }

    .detail-label {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .detail-value {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      text-align: right;
    }

    .upgrade-prompt {
      margin-top: 20px;
      padding: 16px;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
      border-radius: var(--radius-lg);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .upgrade-prompt h4 {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--primary-color);
    }

    .upgrade-prompt p {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }

    .payment-history {
      margin-top: 20px;
    }

    .payment-history h4 {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-primary);
    }

    .payment-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: var(--bg-primary);
      border-radius: var(--radius-md);
      margin-bottom: 8px;
      border: 1px solid var(--border-color);
    }

    .payment-date {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .payment-amount {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .payment-status {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: var(--radius-sm);
      background: rgba(34, 197, 94, 0.1);
      color: #166534;
    }
/* ===== Onglet Facturation ===== */
    
    .billing-section {
      margin-bottom: 24px;
    }

    .billing-section h3 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-primary);
    }

    .payment-method-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .payment-method-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
    }

    .payment-method-details {
      flex: 1;
    }

    .payment-method-details h4 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--text-primary);
    }

    .payment-method-details p {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .invoices-table {
      width: 100%;
      border-collapse: collapse;
    }

    .invoices-table thead {
      background: var(--bg-secondary);
    }

    .invoices-table th {
      padding: 12px 16px;
      text-align: left;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border-color);
    }

    .invoices-table td {
      padding: 16px;
      font-size: 14px;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border-color);
    }

    .invoices-table tbody tr:hover {
      background: var(--bg-secondary);
    }

    .invoice-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: var(--radius-full);
      font-size: 12px;
      font-weight: 500;
    }

    .invoice-status.paid {
      background: rgba(34, 197, 94, 0.1);
      color: #166534;
    }

    .invoice-status.pending {
      background: rgba(251, 191, 36, 0.1);
      color: #92400e;
    }

    .invoice-status.failed {
      background: rgba(239, 68, 68, 0.1);
      color: #991b1b;
    }

    @media (max-width: 768px) {
      .invoices-table {
        display: block;
        overflow-x: auto;
      }
    }
/* ===== Onglet √âquipe ===== */

.team-members-grid {
  display: grid;
  gap: 16px;
}

.team-member-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 16px;
  transition: box-shadow 0.2s ease;
}

.team-member-card:hover {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.member-avatar {
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, #10b981, #059669);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 18px;
  font-weight: 600;
  flex-shrink: 0;
}

.member-info {
  flex: 1;
  min-width: 0;
}

.member-name {
  font-size: 15px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.member-email {
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: 8px;
  overflow: hidden;
  text-overflow: ellipsis;
}

.member-role {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 10px;
  border-radius: var(--radius-full);
  font-size: 12px;
  font-weight: 500;
  background: var(--bg-primary);
  color: var(--text-secondary);
}

.member-actions {
  display: flex;
  gap: 8px;
  flex-shrink: 0;
}

.icon-btn {
  width: 36px;
  height: 36px;
  border-radius: var(--radius-md);
  border: 1px solid var(--border-color);
  background: var(--bg-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 14px;
  color: var(--text-secondary);
}

.icon-btn:hover {
  background: var(--bg-secondary);
  border-color: var(--primary-color);
  color: var(--primary-color);
}

.icon-btn.danger:hover {
  border-color: #ef4444;
  color: #ef4444;
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
}

.empty-state i {
  font-size: 48px;
  color: var(--text-secondary);
  opacity: 0.3;
  margin-bottom: 16px;
}

.empty-state h3 {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 8px;
}

.empty-state p {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 24px;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.modal-content {
  background: var(--bg-primary);
  border-radius: var(--radius-lg);
  max-width: 600px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.modal-header {
  padding: 24px;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-header h2 {
  font-size: 20px;
  font-weight: 600;
  color: var(--text-primary);
}

.modal-close {
  width: 32px;
  height: 32px;
  border-radius: var(--radius-md);
  border: none;
  background: var(--bg-secondary);
  color: var(--text-secondary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.modal-close:hover {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

.modal-body {
  padding: 24px;
}

.modal-footer {
  padding: 24px;
  border-top: 1px solid var(--border-color);
  display: flex;
  gap: 12px;
  justify-content: flex-end;
}

/* ===== PERMISSIONS CUSTOM ===== */

.permissions-grid {
  display: grid;
  gap: 12px;
  margin-top: 16px;
}

.permission-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: var(--bg-secondary);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-color);
}

.permission-item input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
}

.permission-label {
  flex: 1;
}

.permission-label strong {
  font-size: 14px;
  font-weight: 500;
  color: var(--text-primary);
  display: block;
  margin-bottom: 4px;
}

.permission-label span {
  font-size: 12px;
  color: var(--text-secondary);
}

/* ===== TOGGLE SWITCH ===== */

.toggle-switch {
  position: relative;
  width: 44px;
  height: 24px;
  background: #cbd5e1;
  border-radius: 12px;
  cursor: pointer;
  transition: background 0.3s;
}

.toggle-switch.active {
  background: var(--primary-color);
}

.toggle-switch::before {
  content: '';
  position: absolute;
  width: 20px;
  height: 20px;
  background: white;
  border-radius: 50%;
  top: 2px;
  left: 2px;
  transition: transform 0.3s;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.toggle-switch.active::before {
  transform: translateX(20px);
}

@media (max-width: 640px) {
  .team-member-card {
    flex-direction: column;
    align-items: flex-start;
  }

  .member-actions {
    width: 100%;
    justify-content: flex-end;
  }
}
  </style>
</head>
<body>
<div class="platform-layout" id="platformLayout">
<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
<div class="sidebar-header">
<div class="brand">
<i class="fas fa-rocket brand-icon"></i>
<span class="brand-text">Boostinghost</span>
</div>
<button aria-label="Fermer la sidebar" class="sidebar-toggle" id="sidebarClose">
<i class="fas fa-times"></i>
</button>
</div>
<nav class="sidebar-nav">
<a class="nav-link" href="/dashboard.html">
<i class="fas fa-home"></i>
<span>Tableau de bord</span>
</a>
<a class="nav-link" href="/calendar.html">
<i class="fas fa-calendar-alt"></i>
<span>Calendrier</span>
</a>
<a class="nav-link" href="/reservations.html">
<i class="fas fa-book"></i>
<span>R√©servations</span>
</a>
<a class="nav-link" href="/messages.html" id="messages-nav-link">
<i class="fas fa-envelope"></i>
<span>Messages</span>
<span class="badge-count" id="messages-badge" style="display: none;">0</span>
</a>
<a class="nav-link" href="/properties.html">
<i class="fas fa-building"></i>
<span>Logements</span>
</a>
<a class="nav-link" href="/cleaning.html">
<i class="fas fa-broom"></i>
<span>M√©nage</span>
</a>
<a class="nav-link" href="/finances.html">
<i class="fas fa-chart-line"></i>
<span>Finances</span>
</a>
<div class="nav-divider"></div>
<a class="nav-link active" href="/settings.html">
<i class="fas fa-cog"></i>
<span>Param√®tres</span>
</a>
</nav>
<div class="sidebar-footer">
<div class="user-menu">
<div class="user-avatar" id="sidebarUserAvatar">U</div>
<div class="user-info">
<div class="user-name" id="sidebarUserName">Utilisateur</div>
<div class="user-company" id="sidebarUserCompany">Ma soci√©t√©</div>
</div>
<button aria-label="Menu utilisateur" class="user-menu-btn" id="userMenuBtn">
<i class="fas fa-ellipsis-v"></i>
</button>
</div>
<div class="user-dropdown" id="userDropdown">
<a class="dropdown-item" href="/settings.html">
<i class="fas fa-cog"></i>
<span>Param√®tres</span>
</a>
<a class="dropdown-item" href="#" id="logoutBtn">
<i class="fas fa-sign-out-alt"></i>
<span>D√©connexion</span>
</a>
</div>
</div>
</aside>
<!-- Header mobile -->
<header class="mobile-header">
<button aria-label="Ouvrir le menu" class="sidebar-toggle" id="sidebarToggle">
<i class="fas fa-bars"></i>
</button>
<div class="brand">
<i class="fas fa-rocket brand-icon"></i>
<span class="brand-text">Boostinghost</span>
</div>
<div></div>
</header>
<!-- Main content -->
<main class="main-content">
<div class="page-content">
<!-- Header de page -->
<section class="page-header">
<div>
<h1>Param√®tres</h1>
<p class="page-description">G√©rez votre compte, votre abonnement et vos pr√©f√©rences</p>
</div>
</section>
<!-- Onglets param√®tres -->
<div class="settings-tabs">
<button class="settings-tab active" data-tab="account">
<i class="fas fa-user"></i>
Compte
</button>
<button class="settings-tab" data-tab="subscription">
<i class="fas fa-crown"></i>
Abonnement
</button>
<button class="settings-tab" data-tab="billing">
<i class="fas fa-credit-card"></i>
Facturation
</button>
<button class="settings-tab" data-tab="team">
<i class="fas fa-users"></i>
√âquipe
</button>
<button class="settings-tab" data-tab="notifications">
<i class="fas fa-bell"></i>
Notifications
</button>
</div>
<!-- ONGLET COMPTE -->
<div class="tab-pane active" id="tab-account">
<section class="card">
<div class="card-header">
<h2>Informations personnelles</h2>
<p>G√©rez vos informations de compte</p>
</div>
<div class="card-body">
<form id="accountForm">
<div class="form-row-inline">
<div class="form-group">
<label>Pr√©nom</label>
<input class="form-control" id="firstName" placeholder="Jean" required="" type="text"/>
</div>
<div class="form-group">
<label>Nom</label>
<input class="form-control" id="lastName" placeholder="Dupont" required="" type="text"/>
</div>
</div>
<div class="form-group">
<label>Email</label>
<input class="form-control" id="email" placeholder="jean@exemple.fr" required="" type="email"/>
</div>
<div class="form-group">
<label>T√©l√©phone</label>
<input class="form-control" id="phone" placeholder="+33 6 12 34 56 78" type="tel"/>
</div>
<div class="form-group">
<label>Nom de la soci√©t√©</label>
<input class="form-control" id="company" placeholder="Ma Conciergerie" type="text"/>
</div>
<div class="save-status-inline" id="accountSaveStatus"></div>
<button class="btn btn-primary" type="submit">
<i class="fas fa-save"></i>
Enregistrer
</button>
</form>
</div>
</section>
<section class="card">
<div class="card-header">
<h2>S√©curit√©</h2>
<p>Modifier votre mot de passe</p>
</div>
<div class="card-body">
<form id="passwordForm">
<div class="form-group">
<label>Mot de passe actuel</label>
<input class="form-control" id="currentPassword" required="" type="password"/>
</div>
<div class="form-group">
<label>Nouveau mot de passe</label>
<input class="form-control" id="newPassword" required="" type="password"/>
</div>
<div class="form-group">
<label>Confirmer le nouveau mot de passe</label>
<input class="form-control" id="confirmPassword" required="" type="password"/>
</div>
<div class="save-status-inline" id="passwordSaveStatus"></div>
<button class="btn btn-primary" type="submit">
<i class="fas fa-lock"></i>
Modifier le mot de passe
</button>
</form>
</div>
</section>
<section class="card">
<div class="card-header">
<h2>Connexion Stripe</h2>
<p>G√©rez votre compte Stripe pour accepter les paiements</p>
</div>
<div class="card-body">
<div id="stripeStatusContainer">
<div class="pill-status stripe-pill-loading">
<i class="fas fa-spinner fa-spin"></i>
Chargement...
</div>
</div>
<div class="settings-hint" id="stripeHintText">
V√©rification de votre compte Stripe en cours...
</div>
<div id="stripeActionContainer" style="margin-top: 16px;">
</div>
</div>
</section>
</div>
<!-- ONGLET ABONNEMENT -->
<div class="tab-pane" id="tab-subscription">
<section class="card">
<div class="card-header">
<h2>Mon abonnement</h2>
<p>G√©rez votre plan Boostinghost</p>
</div>
<div class="card-body">
<div class="subscription-card" id="subscriptionCard">
<div class="subscription-loading">
<i class="fas fa-spinner fa-spin"></i>
Chargement...
</div>
</div>
</div>
</section>
</div>
<!-- ONGLET FACTURATION -->
<div class="tab-pane" id="tab-billing">
<section class="card">
<div class="card-header">
<h2>Facturation</h2>
<p>G√©rez vos informations de paiement et consultez votre historique</p>
</div>
<div class="card-body">
<div class="billing-section">
<h3>M√©thode de paiement</h3>
<div class="payment-method-card">
<div class="payment-method-icon">
<i class="fas fa-credit-card"></i>
</div>
<div class="payment-method-details">
<h4>Carte bancaire</h4>
<p>‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242</p>
</div>
<button class="btn btn-secondary btn-sm">
<i class="fas fa-edit"></i>
Modifier
</button>
</div>
</div>
<div class="billing-section">
<h3>Historique des factures</h3>
<table class="invoices-table">
<thead>
<tr>
<th>Date</th>
<th>Description</th>
<th>Montant</th>
<th>Statut</th>
<th>Actions</th>
</tr>
</thead>
<tbody>
<tr>
<td>01/01/2024</td>
<td>Plan Pro - Janvier 2024</td>
<td>49,00‚Ç¨</td>
<td><span class="invoice-status paid"><i class="fas fa-check"></i> Pay√©e</span></td>
<td>
<button class="btn btn-secondary btn-sm">
<i class="fas fa-download"></i>
T√©l√©charger
</button>
</td>
</tr>
<tr>
<td>01/12/2023</td>
<td>Plan Pro - D√©cembre 2023</td>
<td>49,00‚Ç¨</td>
<td><span class="invoice-status paid"><i class="fas fa-check"></i> Pay√©e</span></td>
<td>
<button class="btn btn-secondary btn-sm">
<i class="fas fa-download"></i>
T√©l√©charger
</button>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</div>
<!-- ONGLET √âQUIPE -->
<div class="tab-pane" id="tab-team">
<section class="card">
<div class="card-header">
<div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
<div>
<h2>Gestion de l'√©quipe</h2>
<p>Ajoutez des membres et g√©rez leurs permissions</p>
</div>
<button class="btn btn-primary" id="addTeamMemberBtn">
<i class="fas fa-plus"></i>
Ajouter un membre
</button>
</div>
</div>
<div class="card-body">
<div class="team-members-grid" id="teamMembersList">
<div class="subscription-loading">
<i class="fas fa-spinner fa-spin"></i>
Chargement...
</div>
</div>
</div>
</section>
</div>
<!-- ONGLET NOTIFICATIONS -->
<div class="tab-pane" id="tab-notifications">
<section class="card">
<div class="card-header">
<h2>Pr√©f√©rences de notification</h2>
<p>Choisissez comment vous souhaitez √™tre notifi√©</p>
</div>
<div class="card-body">
<div class="form-group">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
<div>
<strong>Nouvelles r√©servations</strong>
<p class="settings-hint">Recevoir un email pour chaque nouvelle r√©servation</p>
</div>
<label class="switch">
<input checked="" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
</div>
<div class="form-group">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
<div>
<strong>Messages voyageurs</strong>
<p class="settings-hint">Recevoir un email pour chaque nouveau message</p>
</div>
<label class="switch">
<input checked="" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
</div>
<div class="form-group">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
<div>
<strong>Rappels de m√©nage</strong>
<p class="settings-hint">Recevoir des rappels pour les t√¢ches de m√©nage √† venir</p>
</div>
<label class="switch">
<input checked="" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
</div>
<div class="form-group">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
<div>
<strong>Rapports hebdomadaires</strong>
<p class="settings-hint">Recevoir un r√©sum√© hebdomadaire de votre activit√©</p>
</div>
<label class="switch">
<input type="checkbox"/>
<span class="slider"></span>
</label>
</div>
</div>
<button class="btn btn-primary">
<i class="fas fa-save"></i>
Enregistrer les pr√©f√©rences
</button>
</div>
</section>
</div>
</div>
</main>
<!-- Bottom bar mobile -->
<div class="bottom-bar" id="bottomBar">
<a class="bottom-bar-item" href="/dashboard.html">
<i class="fas fa-home"></i>
<span>Accueil</span>
</a>
<a class="bottom-bar-item" href="/calendar.html">
<i class="fas fa-calendar-alt"></i>
<span>Calendrier</span>
</a>
<a class="bottom-bar-item" href="/messages.html" id="messages-bottom-link">
<div style="position: relative;">
<i class="fas fa-envelope"></i>
<span class="badge-count-mobile" id="messages-badge-mobile" style="display: none;">0</span>
</div>
<span>Messages</span>
</a>
<button class="bottom-bar-item plus-button" id="plusButton">
<div class="plus-icon">
<i class="fas fa-plus"></i>
</div>
<span>Plus</span>
</button>
<a class="bottom-bar-item active" href="/settings.html">
<i class="fas fa-cog"></i>
<span>Param√®tres</span>
</a>
</div>
<!-- Menu Plus -->
<div class="plus-menu" id="plusMenu">
<div class="plus-menu-content">
<button class="plus-menu-close" id="plusMenuClose">
<i class="fas fa-times"></i>
</button>
<div class="plus-menu-header">
<h3>Menu rapide</h3>
</div>
<div class="plus-menu-grid">
<a class="plus-menu-item" href="/reservations.html">
<div class="plus-menu-icon">
<i class="fas fa-book"></i>
</div>
<span>R√©servations</span>
</a>
<a class="plus-menu-item" href="/properties.html">
<div class="plus-menu-icon">
<i class="fas fa-building"></i>
</div>
<span>Logements</span>
</a>
<a class="plus-menu-item" href="/cleaning.html">
<div class="plus-menu-icon">
<i class="fas fa-broom"></i>
</div>
<span>M√©nage</span>
</a>
<a class="plus-menu-item" href="/finances.html">
<div class="plus-menu-icon">
<i class="fas fa-chart-line"></i>
</div>
<span>Finances</span>
</a>
</div>
</div>
</div>
</div>

<!-- Modal Ajout Membre -->
<div class="modal" id="addTeamMemberModal">
<div class="modal-content">
<div class="modal-header">
<h2>Ajouter un membre</h2>
<button class="modal-close" id="closeAddMemberModal">
<i class="fas fa-times"></i>
</button>
</div>
<div class="modal-body">
<form id="addTeamMemberForm">
<div class="form-row-inline">
<div class="form-group">
<label>Pr√©nom</label>
<input class="form-control" id="memberFirstName" placeholder="Jean" required="" type="text"/>
</div>
<div class="form-group">
<label>Nom</label>
<input class="form-control" id="memberLastName" placeholder="Dupont" required="" type="text"/>
</div>
</div>
<div class="form-group">
<label>Email</label>
<input class="form-control" id="memberEmail" placeholder="jean@exemple.fr" required="" type="email"/>
</div>
<div class="form-group" id="passwordFieldContainer">
<label>Mot de passe</label>
<input class="form-control" id="memberPassword" minlength="6" placeholder="Minimum 6 caract√®res" required="" type="password"/>
</div>
<div class="form-group">
<label>R√¥le</label>
<select class="form-control" id="memberRole" required="">
<option value="manager">Manager</option>
<option value="cleaner">Personnel de m√©nage</option>
<option value="accountant">Comptable</option>
<option value="custom">Personnalis√©</option>
</select>
<p class="settings-hint" id="roleDescription">Acc√®s complet au calendrier, messages et gestion du m√©nage</p>
</div>
<div class="form-group">
<label>Logements accessibles</label>
<div id="memberProperties" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px; padding: 8px;">
<div style="color: #9ca3af; padding: 8px;">Chargement...</div>
</div>
<p class="settings-hint">S√©lectionnez les logements auxquels ce membre aura acc√®s</p>
</div>
<div class="form-group" id="customPermissions" style="display: none;">
<label>Permissions personnalis√©es</label>
<div class="permissions-grid">
<div class="permission-item">
<input id="perm_canViewCalendar" type="checkbox"/>
<div class="permission-label">
<strong>Voir le calendrier</strong>
<span>Consulter les r√©servations</span>
</div>
</div>
<div class="permission-item">
<input id="perm_canEditReservations" type="checkbox"/>
<div class="permission-label">
<strong>Modifier les r√©servations</strong>
<span>√âditer les d√©tails des r√©servations</span>
</div>
</div>
<div class="permission-item">
<input id="perm_canCreateReservations" type="checkbox"/>
<div class="permission-label">
<strong>Cr√©er des r√©servations</strong>
<span>Ajouter de nouvelles r√©servations</span>
</div>
</div>
<div class="permission-item">
<input id="perm_canViewMessages" type="checkbox"/>
<div class="permission-label">
<strong>Voir les messages</strong>
<span>Consulter les conversations</span>
</div>
</div>
<div class="permission-item">
<input id="perm_canSendMessages" type="checkbox"/>
<div class="permission-label">
<strong>Envoyer des messages</strong>
<span>R√©pondre aux voyageurs</span>
</div>
</div>
<div class="permission-item">
<input id="perm_canViewCleaning" type="checkbox"/>
<div class="permission-label">
<strong>Voir le m√©nage</strong>
<span>Consulter les t√¢ches de m√©nage</span>
</div>
</div>
<div class="permission-item">
<input id="perm_canAssignCleaning" type="checkbox"/>
<div class="permission-label">
<strong>G√©rer le m√©nage</strong>
<span>Assigner et modifier les t√¢ches</span>
</div>
</div>
<div class="permission-item">
<input id="perm_canViewFinances" type="checkbox"/>
<div class="permission-label">
<strong>Voir les finances</strong>
<span>Consulter les rapports financiers</span>
</div>
</div>
<div class="permission-item">
<input id="perm_canViewProperties" type="checkbox"/>
<div class="permission-label">
<strong>Voir les logements</strong>
<span>Consulter les d√©tails des logements</span>
</div>
</div>
<div class="permission-item">
<input id="perm_canViewDeposits" type="checkbox"/>
<div class="permission-label">
<strong>Voir les cautions</strong>
<span>Consulter les d√©p√¥ts de garantie</span>
</div>
</div>
<div class="permission-item">
<input id="perm_canManageLocks" type="checkbox"/>
<div class="permission-label">
<strong>G√©rer les serrures</strong>
<span>Cr√©er et g√©rer les codes d'acc√®s</span>
</div>
</div>
</div>
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" id="cancelAddMember">Annuler</button>
<button class="btn btn-primary" form="addTeamMemberForm" type="submit">
<i class="fas fa-save"></i>
Enregistrer
</button>
</div>
</div>
</div>

<!-- ============================================ -->
<!-- üîí PROTECTION DE PAGE - SUB-ACCOUNT -->
<!-- ============================================ -->
<script>
(async function() {
  console.log('üîµ V√©rification authentification sous-compte...');
  
  const token = localStorage.getItem('lcc_token');
  const isSubAccount = localStorage.getItem('is_sub_account') === 'true';
  
  // Si pas de token ou pas un sous-compte -> rediriger vers login
  if (!token || !isSubAccount) {
    console.log('‚ùå Non authentifi√© ou pas un sous-compte');
    window.location.href = '/login.html';
    return;
  }
  
  try {
    // V√©rifier que le token est valide
    const response = await fetch('/api/sub-accounts/verify', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    if (!response.ok) {
      console.log('‚ùå Token invalide');
      localStorage.removeItem('lcc_token');
      localStorage.removeItem('is_sub_account');
      window.location.href = '/login.html';
      return;
    }
    
    const data = await response.json();
    
    if (!data.success || !data.isSubAccount) {
      console.log('‚ùå Pas un sous-compte valide');
      localStorage.removeItem('lcc_token');
      localStorage.removeItem('is_sub_account');
      window.location.href = '/login.html';
      return;
    }
    
    console.log('‚úÖ Sous-compte authentifi√©:', data.subAccount.email);
    
    // Mettre √† jour les infos utilisateur dans le DOM
    if (data.subAccount) {
      const nameEl = document.getElementById('sidebarUserName');
      const avatarEl = document.getElementById('sidebarUserAvatar');
      if (nameEl) nameEl.textContent = `${data.subAccount.firstName} ${data.subAccount.lastName}`;
      if (avatarEl) avatarEl.textContent = data.subAccount.firstName.charAt(0).toUpperCase();
    }
    
  } catch (error) {
    console.error('‚ùå Erreur v√©rification:', error);
    window.location.href = '/login.html';
  }
})();
</script>

<!-- SCRIPT INFORMATIONS UTILISATEUR -->
  <script>
    
    (function() {
      const user = JSON.parse(localStorage.getItem('lcc_user') || '{}');
      if (user.firstName) {
        const nameEl = document.getElementById('sidebarUserName');
        const avatarEl = document.getElementById('sidebarUserAvatar');
        if (nameEl) nameEl.textContent = user.firstName + ' ' + (user.lastName || '');
        if (avatarEl) avatarEl.textContent = user.firstName.charAt(0).toUpperCase();
      }
      if (user.company) {
        const companyEl = document.getElementById('sidebarUserCompany');
        if (companyEl) companyEl.textContent = user.company;
      }
    })();
  </script>

<!-- SCRIPT ABONNEMENT -->
<script>
    // ‚úÖ NOUVEAU : Fonction avec les vrais prix
    function formatEUR(amount) {
      const n = Number(amount || 0);
      return n.toFixed(2).replace('.', ',') + '‚Ç¨';
    }

    // ‚úÖ CORRIG√â : Nouveaux plans et prix
    function priceForPlan(planType) {
      const p = (planType || 'solo').toLowerCase();
      
      // Nouveaux plans
      if (p === 'solo') return 14.90;
      if (p === 'pro') return 49.00;
      if (p === 'business') return 99.00;
      
      // Anciens plans (pour compatibilit√©)
      if (p === 'basic') return 14.90; // Redirection vers Solo
      
      return 14.90; // Par d√©faut : Solo
    }

    // ‚úÖ NOUVEAU : Retourner le nom lisible du plan
    function planDisplayName(planType) {
      const p = (planType || 'solo').toLowerCase();
      
      if (p === 'solo') return 'Solo';
      if (p === 'pro') return 'Pro';
      if (p === 'business') return 'Business';
      if (p === 'basic') return 'Solo'; // Ancien nom
      
      return 'Solo';
    }

    async function loadSubscriptionStatus() {
      const token = localStorage.getItem('lcc_token');
      const subscriptionCard = document.getElementById('subscriptionCard');

      if (!subscriptionCard) return;

      if (!token) {
        subscriptionCard.innerHTML = `
          <div class="alert-warning">
            <i class="fas fa-exclamation-triangle"></i>
            <div>
              <strong>Non connect√©</strong><br>
              Veuillez vous connecter pour voir votre abonnement.
            </div>
          </div>
        `;
        return;
      }

      try {
        const res = await fetch('/api/subscription/status', {
          headers: { 'Authorization': 'Bearer ' + token }
        });

        if (!res.ok) throw new Error('Erreur');

        const data = await res.json();

        if (!data.status) {
          subscriptionCard.innerHTML = `
            <div class="subscription-header">
              <div class="subscription-info">
                <h3>Aucun abonnement actif</h3>
                <p style="color: var(--text-secondary); margin-top: 8px;">
                  Choisissez un plan pour continuer √† utiliser Boostinghost.
                </p>
              </div>
            </div>
            <div class="subscription-actions" style="margin-top: 20px;">
              <a href="/pricing.html" class="btn btn-primary">
                <i class="fas fa-arrow-right"></i>
                Choisir un plan
              </a>
            </div>
          `;
          return;
        }

        let statusBadgeClass = 'trial';
        let statusBadgeText = 'Essai gratuit';
        let statusBadgeIcon = 'fa-hourglass-half';

        if (data.status === 'active') {
          statusBadgeClass = 'active';
          statusBadgeText = 'Actif';
          statusBadgeIcon = 'fa-check-circle';
        } else if (data.status === 'expired' || data.status === 'canceled') {
          statusBadgeClass = 'expired';
          statusBadgeText = 'Expir√©';
          statusBadgeIcon = 'fa-exclamation-circle';
        }

        let daysRemainingHtml = '';
        if (data.trialEndsAt && data.status === 'trial') {
          const now = new Date();
          const endDate = new Date(data.trialEndsAt);
          const daysLeft = Math.ceil((endDate - now) / (1000 * 60 * 60 * 24));
          daysRemainingHtml = `
            <div class="days-remaining">
              <i class="fas fa-clock"></i>
              ${daysLeft} jour${daysLeft > 1 ? 's' : ''} restant${daysLeft > 1 ? 's' : ''}
            </div>
          `;
        }

        let actionsHtml = '';
        if (data.status === 'trial') {
          actionsHtml = `
            <div class="subscription-actions">
              <a href="/pricing.html" class="btn btn-primary">
                <i class="fas fa-crown"></i>
                Passer √† un plan payant
              </a>
            </div>
          `;
        } else if (data.status === 'active') {
          actionsHtml = `
            <div class="subscription-actions">
              <button class="btn btn-secondary" onclick="manageSubscription()">
                <i class="fas fa-cog"></i>
                G√©rer l'abonnement
              </button>
            </div>
          `;
        } else if (data.status === 'expired' || data.status === 'canceled') {
          actionsHtml = `
            <div class="subscription-actions">
              <a href="/pricing.html" class="btn btn-primary">
                <i class="fas fa-arrow-right"></i>
                R√©activer mon abonnement
              </a>
            </div>
          `;
        }

        // ‚úÖ UTILISATION DES NOUVELLES FONCTIONS
        const planName = planDisplayName(data.planType);
        const planPrice = priceForPlan(data.planType);

        subscriptionCard.innerHTML = `
          <div class="subscription-header">
            <div class="subscription-info">
              <h3>Plan ${planName}</h3>
              <div class="subscription-status">
                <span class="status-badge ${statusBadgeClass}">
                  <i class="fas ${statusBadgeIcon}"></i>
                  ${statusBadgeText}
                </span>
                ${daysRemainingHtml}
              </div>
            </div>
            ${actionsHtml}
          </div>
          <div class="subscription-details">
            <div class="detail-row">
              <span class="detail-label">Prix mensuel</span>
              <span class="detail-value">${formatEUR(planPrice)}</span>
            </div>
            ${data.nextBillingDate ? `
            <div class="detail-row">
              <span class="detail-label">Prochaine facturation</span>
              <span class="detail-value">${new Date(data.nextBillingDate).toLocaleDateString('fr-FR')}</span>
            </div>
            ` : ''}
            ${data.cancelAtPeriodEnd ? `
            <div class="detail-row">
              <span class="detail-label">Annulation pr√©vue</span>
              <span class="detail-value" style="color: #ef4444;">
                ${new Date(data.currentPeriodEnd).toLocaleDateString('fr-FR')}
              </span>
            </div>
            ` : ''}
          </div>
        `;

      } catch (error) {
        console.error('Erreur chargement abonnement:', error);
        subscriptionCard.innerHTML = `
          <div class="alert-error">
            <i class="fas fa-exclamation-triangle"></i>
            <div>
              <strong>Erreur</strong><br>
              Impossible de charger les informations d'abonnement.
            </div>
          </div>
        `;
      }
    }

    async function manageSubscription() {
      const token = localStorage.getItem('lcc_token');
      if (!token) {
        alert('Vous devez √™tre connect√©');
        return;
      }

      try {
        const res = await fetch('/api/stripe/create-portal-session', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          }
        });

        const data = await res.json();

        if (data.url) {
          window.location.href = data.url;
        } else {
          alert('Erreur lors de la redirection vers le portail Stripe');
        }
      } catch (error) {
        console.error('Erreur:', error);
        alert('Erreur lors de la cr√©ation de la session portail');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const subTab = document.querySelector('[data-tab="subscription"]');
      if (subTab) {
        subTab.addEventListener('click', () => {
          setTimeout(loadSubscriptionStatus, 100);
        });
      }
    });
  </script>

<!-- SCRIPT ONGLETS -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.settings-tab');
    const panes = document.querySelectorAll('.tab-pane');
    
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const targetId = tab.getAttribute('data-tab');
        
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        panes.forEach(pane => {
          if (pane.id === 'tab-' + targetId) {
            pane.classList.add('active');
          } else {
            pane.classList.remove('active');
          }
        });
      });
    });
  });
</script>

<!-- SCRIPT √âQUIPE -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const ROLE_DESCRIPTIONS = {
    manager: 'Acc√®s complet au calendrier, messages et gestion du m√©nage',
    cleaner: 'Acc√®s au calendrier et aux t√¢ches de m√©nage uniquement',
    accountant: 'Acc√®s aux finances et au calendrier en lecture seule',
    custom: 'D√©finir les permissions manuellement'
  };
  
  let editingMemberId = null;
  
  async function loadTeamMembers() {
    console.log('üîµ Chargement √©quipe...');
    const container = document.getElementById('teamMembersList');
    
    container.innerHTML = `
      <div class="subscription-loading">
        <i class="fas fa-spinner fa-spin"></i>
        Chargement...
      </div>
    `;
    
    try {
      const token = localStorage.getItem('lcc_token');
      const res = await fetch('/api/sub-accounts/list', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      
      const data = await res.json();
      console.log('üì¶ Donn√©es re√ßues:', data);
      
      if (!data.success) throw new Error(data.error);
      
      if (!data.subAccounts || data.subAccounts.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-users"></i>
            <h3>Aucun membre dans l'√©quipe</h3>
            <p>Ajoutez des membres pour collaborer efficacement</p>
            <button class="btn btn-primary" onclick="document.getElementById('addTeamMemberBtn').click()">
              <i class="fas fa-plus"></i>
              Ajouter votre premier membre
            </button>
          </div>
        `;
        return;
      }
      
      container.innerHTML = data.subAccounts.map(member => {
        const initials = (member.first_name.charAt(0) + member.last_name.charAt(0)).toUpperCase();
        const isActive = member.is_active;
        const roleText = {
          manager: 'Manager',
          cleaner: 'Personnel de m√©nage',
          accountant: 'Comptable',
          custom: 'Personnalis√©'
        }[member.role] || 'Personnalis√©';
        
        // ‚úÖ NOUVEAU : Affichage des logements accessibles
        let propertiesHtml = '';
        if (member.accessible_properties && member.accessible_properties.length > 0) {
          // Utiliser le cache global si disponible
          const properties = window.cachedProperties || [];
          const propertyNames = member.accessible_properties.map(propId => {
            const prop = properties.find(p => p.id === propId);
            return prop ? prop.name : `Logement #${propId}`;
          });
          
          propertiesHtml = `
            <div style="margin-top: 8px; font-size: 12px; color: var(--text-secondary);">
              <i class="fas fa-building" style="margin-right: 4px;"></i>
              ${propertyNames.join(', ')}
            </div>
          `;
        }
        
        return `
          <div class="team-member-card" style="${!isActive ? 'opacity: 0.6;' : ''}">
            <div class="member-avatar">${initials}</div>
            <div class="member-info">
              <div class="member-name">${member.first_name} ${member.last_name}</div>
              <div class="member-email">${member.email}</div>
              <span class="member-role">
                <i class="fas fa-user-tag"></i>
                ${roleText}
              </span>
              ${propertiesHtml}
            </div>
            <div class="member-actions">
              <button 
                class="icon-btn" 
                onclick="toggleTeamMember(${member.id})"
                title="${isActive ? 'D√©sactiver' : 'Activer'}">
                <i class="fas fa-${isActive ? 'pause' : 'play'}"></i>
              </button>
              <button 
                class="icon-btn" 
                onclick="editTeamMember(${member.id})"
                title="Modifier">
                <i class="fas fa-edit"></i>
              </button>
              <button 
                class="icon-btn danger" 
                onclick="deleteTeamMember(${member.id}, '${member.email}')"
                title="Supprimer">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        `;
      }).join('');
      
      console.log('‚úÖ √âquipe charg√©e:', data.subAccounts.length);
    } catch (error) {
      console.error('‚ùå Erreur chargement √©quipe:', error);
      container.innerHTML = `
        <div class="alert-error">
          <i class="fas fa-exclamation-triangle"></i>
          <div>
            <strong>Erreur</strong><br>
            ${error.message}
          </div>
        </div>
      `;
    }
  }
  
  const addBtn = document.getElementById('addTeamMemberBtn');
  if (addBtn) {
    addBtn.addEventListener('click', async () => {
      editingMemberId = null;
      document.querySelector('#addTeamMemberModal h2').textContent = 'Ajouter un membre';
      document.getElementById('addTeamMemberForm').reset();
      document.getElementById('memberRole').dispatchEvent(new Event('change'));
      const pwdField = document.getElementById('memberPassword');
      if (pwdField) {
        pwdField.required = true;
        pwdField.parentElement.style.display = 'block';
      }
      const modal = document.getElementById('addTeamMemberModal');
      if (modal) {
        modal.style.display = 'flex';
        await loadPropertiesForSelect();
      }
    });
  }
  
  document.getElementById('closeAddMemberModal')?.addEventListener('click', () => {
    document.getElementById('addTeamMemberModal').style.display = 'none';
  });
  
  document.getElementById('cancelAddMember')?.addEventListener('click', () => {
    document.getElementById('addTeamMemberModal').style.display = 'none';
  });
  
  document.getElementById('memberRole')?.addEventListener('change', function() {
    const desc = document.getElementById('roleDescription');
    const customPerms = document.getElementById('customPermissions');
    if (desc) desc.textContent = ROLE_DESCRIPTIONS[this.value] || '';
    if (customPerms) customPerms.style.display = this.value === 'custom' ? 'block' : 'none';
  });
  
  async function loadPropertiesForSelect() {
    try {
      const token = localStorage.getItem('lcc_token');
      const res = await fetch('/api/properties', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await res.json();
      const container = document.getElementById('memberProperties');
      if (!container) return;
      
      // ‚úÖ Stocker dans un cache global pour l'affichage des cartes
      window.cachedProperties = data.properties || [];
      
      if (!data.properties || data.properties.length === 0) {
        container.innerHTML = '<div style="color:#9ca3af;padding:8px;">Aucun logement</div>';
        return;
      }
      
      // ‚úÖ NOUVEAU : G√©n√©rer des checkboxes au lieu d'un select
      container.innerHTML = data.properties.map(p => `
        <label style="display:flex;align-items:center;gap:10px;padding:8px;cursor:pointer;border-radius:6px;transition:background 0.2s;" 
               onmouseover="this.style.background='#f3f4f6'" 
               onmouseout="this.style.background='transparent'">
          <input type="checkbox" 
                 class="property-checkbox" 
                 value="${p.id}" 
                 style="width:18px;height:18px;cursor:pointer;">
          <span style="flex:1;font-size:14px;">${p.name}</span>
        </label>
      `).join('');
      
      console.log('‚úÖ Propri√©t√©s charg√©es:', data.properties.length);
    } catch (error) {
      console.error('Erreur propri√©t√©s:', error);
    }
  }
  
  document.getElementById('addTeamMemberForm')?.addEventListener('submit', async function(e) {
    e.preventDefault();
    const role = document.getElementById('memberRole').value;
    
    // ‚úÖ NOUVEAU : R√©cup√©rer les checkboxes coch√©es au lieu des options s√©lectionn√©es
    const checkedBoxes = Array.from(document.querySelectorAll('.property-checkbox:checked'));
    const propertyIds = checkedBoxes.map(cb => cb.value);
    
    const data = {
      email: document.getElementById('memberEmail').value,
      firstName: document.getElementById('memberFirstName').value,
      lastName: document.getElementById('memberLastName').value,
      role: role,
      propertyIds: propertyIds
    };
    
    if (!editingMemberId) {
      data.password = document.getElementById('memberPassword').value;
    }
    
    if (role === 'custom') {
      data.permissions = {
        can_view_reservations: document.getElementById('perm_canViewCalendar')?.checked || false,
        can_edit_reservations: document.getElementById('perm_canEditReservations')?.checked || false,
        can_create_reservations: document.getElementById('perm_canCreateReservations')?.checked || false,
        can_view_messages: document.getElementById('perm_canViewMessages')?.checked || false,
        can_send_messages: document.getElementById('perm_canSendMessages')?.checked || false,
        can_view_cleaning: document.getElementById('perm_canViewCleaning')?.checked || false,
        can_manage_cleaning: document.getElementById('perm_canAssignCleaning')?.checked || false,
        can_view_properties: document.getElementById('perm_canViewProperties')?.checked || false,
        can_edit_properties: false,
        can_view_finances: document.getElementById('perm_canViewFinances')?.checked || false,
        can_manage_team: false,
        can_view_deposits: document.getElementById('perm_canViewDeposits')?.checked || false,
        can_manage_locks: document.getElementById('perm_canManageLocks')?.checked || false
      };
      console.log('üîê Permissions:', data.permissions);
    }
    
    try {
      const token = localStorage.getItem('lcc_token');
      const endpoint = editingMemberId ? `/api/sub-accounts/${editingMemberId}` : '/api/sub-accounts/create';
      const method = editingMemberId ? 'PUT' : 'POST';
      
      const res = await fetch(endpoint, {
        method: method,
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
        body: JSON.stringify(data)
      });
      
      const result = await res.json();
      if (!result.success) throw new Error(result.error);
      
      alert(editingMemberId ? '‚úÖ Modifi√©' : '‚úÖ Ajout√©');
      document.getElementById('addTeamMemberModal').style.display = 'none';
      this.reset();
      editingMemberId = null;
      loadTeamMembers();
    } catch (error) {
      alert('‚ùå ' + error.message);
    }
  });
  
  window.editTeamMember = async function(id) {
    console.log('üîµ Edit:', id);
    try {
      const token = localStorage.getItem('lcc_token');
      const res = await fetch('/api/sub-accounts/list', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await res.json();
      if (!data.success) throw new Error(data.error);
      
      const member = data.subAccounts.find(m => m.id === id);
      if (!member) throw new Error('Membre introuvable');
      
      editingMemberId = id;
      await loadPropertiesForSelect();
      
      document.getElementById('memberEmail').value = member.email;
      document.getElementById('memberFirstName').value = member.first_name;
      document.getElementById('memberLastName').value = member.last_name;
      document.getElementById('memberRole').value = member.role;
      
      const pwdField = document.getElementById('memberPassword');
      if (pwdField) {
        pwdField.required = false;
        pwdField.value = '';
        pwdField.parentElement.style.display = 'none';
      }
      
      document.getElementById('memberRole').dispatchEvent(new Event('change'));
      
      // ‚úÖ NOUVEAU : Cocher les checkboxes au lieu de s√©lectionner les options
      if (member.accessible_properties && member.accessible_properties.length > 0) {
        const checkboxes = document.querySelectorAll('.property-checkbox');
        checkboxes.forEach(checkbox => {
          checkbox.checked = member.accessible_properties.includes(checkbox.value);
        });
      }
      
      if (member.role === 'custom') {
        if (document.getElementById('perm_canViewCalendar')) document.getElementById('perm_canViewCalendar').checked = member.can_view_reservations || false;
        if (document.getElementById('perm_canEditReservations')) document.getElementById('perm_canEditReservations').checked = member.can_edit_reservations || false;
        if (document.getElementById('perm_canCreateReservations')) document.getElementById('perm_canCreateReservations').checked = member.can_create_reservations || false;
        if (document.getElementById('perm_canViewMessages')) document.getElementById('perm_canViewMessages').checked = member.can_view_messages || false;
        if (document.getElementById('perm_canSendMessages')) document.getElementById('perm_canSendMessages').checked = member.can_send_messages || false;
        if (document.getElementById('perm_canViewCleaning')) document.getElementById('perm_canViewCleaning').checked = member.can_view_cleaning || false;
        if (document.getElementById('perm_canAssignCleaning')) document.getElementById('perm_canAssignCleaning').checked = member.can_manage_cleaning || false;
        if (document.getElementById('perm_canViewFinances')) document.getElementById('perm_canViewFinances').checked = member.can_view_finances || false;
        if (document.getElementById('perm_canViewProperties')) document.getElementById('perm_canViewProperties').checked = member.can_view_properties || false;
        if (document.getElementById('perm_canViewDeposits')) document.getElementById('perm_canViewDeposits').checked = member.can_view_deposits || false;
        if (document.getElementById('perm_canManageLocks')) document.getElementById('perm_canManageLocks').checked = member.can_manage_locks || false;
      }
      
      document.querySelector('#addTeamMemberModal h2').textContent = 'Modifier le membre';
      document.getElementById('addTeamMemberModal').style.display = 'flex';
      console.log('‚úÖ Modal √©dition ouverte');
    } catch (error) {
      alert('‚ùå ' + error.message);
    }
  };
  
  window.deleteTeamMember = async function(id, email) {
    if (!confirm(`Supprimer ${email} ?`)) return;
    try {
      const token = localStorage.getItem('lcc_token');
      const res = await fetch(`/api/sub-accounts/${id}`, {
        method: 'DELETE',
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await res.json();
      if (!data.success) throw new Error(data.error);
      alert('‚úÖ Supprim√©');
      loadTeamMembers();
    } catch (error) {
      alert('‚ùå ' + error.message);
    }
  };
  
  window.toggleTeamMember = async function(id) {
    try {
      const token = localStorage.getItem('lcc_token');
      const res = await fetch(`/api/sub-accounts/${id}/toggle`, {
        method: 'PUT',
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await res.json();
      if (!data.success) throw new Error(data.error);
      loadTeamMembers();
    } catch (error) {
      alert('‚ùå ' + error.message);
    }
  };
  
  const teamTab = document.querySelector('[data-tab="team"]');
  if (teamTab) {
    teamTab.addEventListener('click', () => setTimeout(loadTeamMembers, 100));
  }
  
  console.log('‚úÖ Script √©quipe initialis√©');
});
</script>

<script src="/js/bh-layout.js"></script>
<script src="/js/mobile-native-experience.js"></script>
<script src="/js/mobile-tabs-handler.js"></script>
<script src="/js/messages-badge-desktop-mobile.js"></script>
<script src="/js/messages-badge-dynamic.js"></script>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

</body>
</html>
