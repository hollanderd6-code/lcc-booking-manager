<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Messages – Boostinghost</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <!-- CSS plateforme -->
  <link rel="stylesheet" href="/css/style.css">

  <style>
    html, body {
      margin: 0 !important;
      padding: 0 !important;
    }

    .main-content {
      padding-top: 24px !important;
    }

    .page-content {
      margin-top: 0 !important;
    }

    .messages-page-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .messages-page-title i {
      color: var(--primary-color);
    }

    /* ===== Cards & timelines ===== */

    .timeline-section {
      background: var(--bg-primary);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid var(--border-color);
    }

    .timeline-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-color);
    }

    .timeline-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: white;
    }

    .timeline-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .timeline-count {
      background: var(--primary-light);
      color: var(--primary-color);
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      margin-left: auto;
    }

    .reservation-list {
      display: grid;
      gap: 16px;
    }

    .reservation-item {
      padding: 16px;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      border-left: 4px solid var(--primary-color);
      transition: var(--transition);
    }

    .reservation-item:hover {
      box-shadow: var(--shadow-sm);
      transform: translateX(4px);
    }

    .reservation-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .reservation-info h3 {
      font-size: 15px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .reservation-meta {
      color: var(--text-secondary);
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .empty-state i {
      font-size: 40px;
      opacity: 0.3;
      margin-bottom: 12px;
    }

    .copy-btn {
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition-fast);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    .copy-btn:hover {
      background: var(--primary-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .copy-btn.copied {
      background: #16a34a;
    }
  </style>
</head>
<body data-page="messages">
  <!-- MOBILE HEADER -->
  <div class="mobile-header">
    <a href="/app.html" class="mobile-logo">
      <i class="fas fa-calendar-check"></i>
      <span class="mobile-logo-text">Bookingmanage</span>
    </a>
    <button class="mobile-menu-btn" id="mobileMenuBtn">
      <i class="fas fa-bars"></i>
    </button>
  </div>
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <a href="/" class="sidebar-logo">
  <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" style="flex-shrink:0;">
    <path d="M8 20V34C8 35.1046 8.89543 36 10 36H30C31.1046 36 32 35.1046 32 34V20" 
          stroke="#3B82F6" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M16 36V26H24V36" 
          stroke="#3B82F6" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M20 4L4 18H10V22H30V18H36L20 4Z" 
          fill="#10B981" stroke="#10B981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M20 9L24 14H16L20 9Z" fill="white"/>
  </svg>
  <div class="sidebar-logo-text" style="display: flex; flex-direction: column; justify-content: center; margin-left: 10px;">
    <span class="sidebar-logo-title" style="font-family: 'Inter', sans-serif; font-size: 17px; line-height: 1.1;">
      <span style="color: #10B981; font-weight: 800;">Boosting</span><span style="color: #111827; font-weight: 600;">host</span>
    </span>
    <span class="sidebar-logo-subtitle" style="font-size: 10px; color: #6B7280; font-weight: 500; letter-spacing: 0.5px;">
      Smart Property Manager
    </span>
  </div>
</a>
      
      <nav class="sidebar-nav">
        <!-- PRINCIPAL -->
        <div class="nav-section">
          <div class="nav-section-title">Principal</div>

          <a href="/app.html" class="nav-item active" data-page="app">
            <i class="fas fa-th-large"></i>
            <span>Dashboard</span>
          </a>

          <a href="/app.html#calendarSection" class="nav-item" id="navCalendarLink">
            <i class="fas fa-calendar"></i>
            <span>Calendrier</span>
            <span class="nav-badge" id="navTotalReservations">0</span>
          </a>

          <a href="/messages.html" class="nav-item active" data-page="messages">
            <i class="fas fa-comment-dots"></i>
            <span>Messages</span>
          </a>
        </div>

        <!-- GESTION -->
        <div class="nav-section">
          <div class="nav-section-title">Gestion</div>

          <a href="/settings.html" class="nav-item" data-page="settings">
            <i class="fas fa-home"></i>
            <span>Mes logements</span>
          </a>

          <a href="/welcome.html" class="nav-item" data-page="welcome">
            <i class="fas fa-book-open"></i>
            <span>Livret d'accueil</span>
          </a>

          <a href="/cleaning.html" class="nav-item" data-page="cleaning">
            <i class="fas fa-broom"></i>
            <span>Gestion du ménage</span>
             </a>

          <div class="nav-section">
  <div class="nav-section-title"><Facturation></Facturation></div>
  <a href="/factures.html" class="nav-item">
    <i class="fas fa-file-invoice"></i>
    <span>Factures clients</span>
  </a>
  <a href="/factures-proprietaires.html" class="nav-item">
    <i class="fas fa-file-invoice-dollar"></i>
    <span>Factures propriétaires</span>
  </a>
</div>


          <a href="/deposits.html" class="nav-item" data-page="deposits">
            <i class="fas fa-shield-alt"></i>
            <span>Cautions</span>
          </a>

          <a href="/notifications.html" class="nav-item" data-page="notifications">
            <i class="fas fa-bell"></i>
            <span>Notifications</span>
          </a>
        </div>

        <!-- PARAMÈTRES -->
        <div class="nav-section">
          <div class="nav-section-title">Paramètres</div>

          <a href="/settings-account.html" class="nav-item" data-page="settings-account">
            <i class="fas fa-cog"></i>
            <span>Paramètres</span>
          </a>

          <a href="/help.html" class="nav-item" data-page="help">
            <i class="fas fa-question-circle"></i>
            <span>Aide</span>
          </a>
        </div>
      </nav>
      
      <div class="sidebar-footer">
        <div class="user-profile">
          <div class="user-avatar" id="sidebarUserAvatar">C</div>
          <div class="user-info">
            <div class="user-name" id="sidebarUserName">Utilisateur</div>
            <div class="user-email" id="sidebarUserCompany">Mon espace</div>
          </div>

          <button class="btn btn-ghost btn-xs" id="logoutBtn"><i class="fas fa-sign-out-alt"></i></button>
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main-content">
      <!-- Header -->
      <header class="main-header">
        <div class="header-left">
          <div class="page-kicker">Communication</div>
          <h1 class="page-title messages-page-title">
            <i class="fas fa-comment-dots"></i>
            Messages
          </h1>
          <p class="page-subtitle">
            Préparez vos messages pour les voyageurs en quelques clics.
          </p>
        </div>
      </header>

      <!-- Page Content -->
      <div class="page-content">
        <!-- Messages rapides – timeline réservations -->
        <section class="timeline-section">
          <div class="timeline-header">
            <div class="timeline-icon" style="background:#10b981;">
              <i class="fas fa-calendar-check"></i>
            </div>
            <div class="timeline-title">Messages rapides – arrivées & séjours</div>
          </div>

          <!-- Arrivées aujourd'hui -->
          <div class="timeline-section" id="checkinsToday">
            <div class="timeline-header">
              <div class="timeline-icon" style="background: #e74c3c;">
                <i class="fas fa-door-open"></i>
              </div>
              <div class="timeline-title">Arrivées aujourd'hui</div>
              <div class="timeline-count" id="countToday">0</div>
            </div>
            <div class="reservation-list" id="listToday"></div>
          </div>

          <!-- Arrivées demain -->
          <div class="timeline-section" id="checkinsTomorrow">
            <div class="timeline-header">
              <div class="timeline-icon" style="background: #f39c12;">
                <i class="fas fa-calendar-day"></i>
              </div>
              <div class="timeline-title">Arrivées demain</div>
              <div class="timeline-count" id="countTomorrow">0</div>
            </div>
            <div class="reservation-list" id="listTomorrow"></div>
          </div>

          <!-- Prochains 7 jours -->
          <div class="timeline-section" id="checkinsNext7">
            <div class="timeline-header">
              <div class="timeline-icon" style="background: #3498db;">
                <i class="fas fa-calendar-week"></i>
              </div>
              <div class="timeline-title">Prochains 7 jours</div>
              <div class="timeline-count" id="countNext7">0</div>
            </div>
            <div class="reservation-list" id="listNext7"></div>
          </div>

          <!-- Séjours en cours -->
          <div class="timeline-section" id="currentStays">
            <div class="timeline-header">
              <div class="timeline-icon" style="background: #2ecc71;">
                <i class="fas fa-home"></i>
              </div>
              <div class="timeline-title">Séjours en cours</div>
              <div class="timeline-count" id="countCurrent">0</div>
            </div>
            <div class="reservation-list" id="listCurrent"></div>
          </div>

          <!-- Départs aujourd'hui -->
          <div class="timeline-section" id="checkoutsToday">
            <div class="timeline-header">
              <div class="timeline-icon" style="background: #95a5a6;">
                <i class="fas fa-sign-out-alt"></i>
              </div>
              <div class="timeline-title">Départs aujourd'hui</div>
              <div class="timeline-count" id="countCheckouts">0</div>
            </div>
            <div class="reservation-list" id="listCheckouts"></div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <div class="toast-container" id="toastContainer"></div>
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Chargement...</p>
    </div>
  </div>

  <!-- JS spécifique messages (timeline) -->
  <script src="/js/messages.js"></script>

  <!-- Script auth + user + logout + menu mobile + nav active -->
  <script>
    (async function checkSubscriptionAccess() {
    const token = localStorage.getItem('lcc_token');
    
    if (!token) {
      window.location.href = '/login.html';
      return;
    }

    try {
      const res = await fetch('/api/subscription/status', {
        headers: { 'Authorization': 'Bearer ' + token }
      });

      if (!res.ok) {
        if (res.status === 401 || res.status === 403) {
          localStorage.removeItem('lcc_token');
          localStorage.removeItem('lcc_user');
          window.location.href = '/login.html';
        }
        return;
      }

      const data = await res.json();

      if (data.status === 'expired' || data.status === 'canceled') {
        window.location.href = '/subscription-expired.html';
        return;
      }

      if (data.status === 'trial' && data.daysRemaining !== null && data.daysRemaining < 0) {
        window.location.href = '/subscription-expired.html';
        return;
      }

    } catch (err) {
      console.error('Erreur vérification abonnement:', err);
    }
  })();
    (function () {
      const token = localStorage.getItem('lcc_token');
      if (!token) {
        window.location.href = '/login.html';
        return;
      }

      const rawUser = localStorage.getItem('lcc_user');
      let user = null;

      try {
        user = rawUser ? JSON.parse(rawUser) : null;
      } catch (e) {
        console.error('Impossible de lire lcc_user', e);
      }

      if (user) {
        const nameEl = document.getElementById('sidebarUserName');
        const companyEl = document.getElementById('sidebarUserCompany');
        const avatarEl = document.getElementById('sidebarUserAvatar');

        if (nameEl) {
          nameEl.textContent = user.firstName
            ? user.firstName + (user.lastName ? ' ' + user.lastName : '')
            : (user.email || 'Mon compte');
        }

        if (companyEl) {
          companyEl.textContent = user.company || 'Mon espace';
        }

        if (avatarEl) {
          const initial = (user.firstName || user.email || '?').trim()[0] || 'U';
          avatarEl.textContent = initial.toUpperCase();
        }
      }

      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function () {
          localStorage.removeItem('lcc_token');
          localStorage.removeItem('lcc_user');
          window.location.href = '/login.html';
        });
      }

      // Mobile menu
      const menuBtn = document.getElementById('mobileMenuBtn');
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.getElementById('sidebarOverlay');

      if (menuBtn && sidebar && overlay) {
        menuBtn.addEventListener('click', function() {
          sidebar.classList.toggle('active');
          overlay.classList.toggle('active');

          const icon = menuBtn.querySelector('i');
          if (sidebar.classList.contains('active')) {
            icon.classList.remove('fa-bars');
            icon.classList.add('fa-times');
          } else {
            icon.classList.remove('fa-times');
            icon.classList.add('fa-bars');
          }
        });

        overlay.addEventListener('click', function() {
          sidebar.classList.remove('active');
          overlay.classList.remove('active');
          const icon = menuBtn.querySelector('i');
          icon.classList.remove('fa-times');
          icon.classList.add('fa-bars');
        });

        if (window.innerWidth <= 1024) {
          document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
              sidebar.classList.remove('active');
              overlay.classList.remove('active');
              const icon = menuBtn.querySelector('i');
              icon.classList.remove('fa-times');
              icon.classList.add('fa-bars');
            });
          });
        }
      }

      // Nav active
      const currentPage = document.body.getAttribute('data-page');
      if (currentPage) {
        document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.remove('active');
        });
        const activeLink = document.querySelector('.nav-item[data-page="messages"]');
        if (activeLink) {
          activeLink.classList.add('active');
        }
      }
    })();
  </script>
</body>
</html>
